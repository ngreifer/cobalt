<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Frequently Asked Questions • cobalt</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Frequently Asked Questions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cobalt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.5.5.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/cobalt.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/other-packages.html">Using `cobalt` with Other Preprocessing Packages</a></li>
    <li><a class="dropdown-item" href="../articles/segmented-data.html">Using `cobalt` with Clustered, Multiply Imputed, and Other Segmented Data</a></li>
    <li><a class="dropdown-item" href="../articles/longitudinal-treat.html">Using `cobalt` with Longitudinal Treatments</a></li>
    <li><a class="dropdown-item" href="../articles/love.plot.html">Using `love.plot()` To Generate Love Plots</a></li>
    <li><a class="dropdown-item" href="../articles/optimizing-balance.html">Optimizing Tuning Parameters for Balance</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/cobalt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Frequently Asked Questions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/cobalt/blob/master/vignettes/faq.Rmd" class="external-link"><code>vignettes/faq.Rmd</code></a></small>
      <div class="d-none name"><code>faq.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="how-are-standardized-mean-differences-computed-in-cobalt">How are standardized mean differences computed in
<code>cobalt</code>?<a class="anchor" aria-label="anchor" href="#how-are-standardized-mean-differences-computed-in-cobalt"></a>
</h3>
<p>Most questions below are related to this one, so here I will try to
explain in complete detail how standardized mean differences (SMDs) are
computed.</p>
<p>First, it is important to know that by default, <strong>mean
differences for binary covariates are not standardized</strong>. That
means in the <code>Diff.Adj</code> column, etc., what you are seeing the
is <em>raw difference in proportion</em> for binary variables. (By raw,
I mean unstandardized, but weights may be applied if relevant.) To
request SMDs for binary covariates, set <code>binary = "std"</code> in
the call to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> or <code><a href="../reference/love.plot.html">love.plot()</a></code>. See also
the question below.</p>
<p>For continuous covariates, the standardized mean difference is
computed as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">SMD</mtext><mo>=</mo><mfrac><mrow><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mn>1</mn></msub><mo>−</mo><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mn>0</mn></msub></mrow><msup><mi>s</mi><mo>*</mo></msup></mfrac></mrow><annotation encoding="application/x-tex">
\text{SMD} = \frac{\bar{x}_1 - \bar{x}_0}{s^*}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mn>1</mn></msub><annotation encoding="application/x-tex">\bar{x}_1</annotation></semantics></math>
is the mean of the covariate in the treated group,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mn>0</mn></msub><annotation encoding="application/x-tex">\bar{x}_0</annotation></semantics></math>
is the mean of the covariate in the control group, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>s</mi><mo>*</mo></msup><annotation encoding="application/x-tex">s^*</annotation></semantics></math>
is a standardization factor (not necessarily a standard deviation!).
After matching or weighting, the weighted standardized mean difference
is computed as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mtext mathvariant="normal">SMD</mtext><mi>w</mi></msup><mo>=</mo><mfrac><mrow><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mrow><mn>1</mn><mi>w</mi></mrow></msub><mo>−</mo><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mrow><mn>0</mn><mi>w</mi></mrow></msub></mrow><msup><mi>s</mi><mo>*</mo></msup></mfrac></mrow><annotation encoding="application/x-tex">
\text{SMD}^w = \frac{\bar{x}_{1w} - \bar{x}_{0w}}{s^*}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mrow><mn>1</mn><mi>w</mi></mrow></msub><annotation encoding="application/x-tex">\bar{x}_{1w}</annotation></semantics></math>
is the weighted mean of the covariate in the treated group, i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mrow><mn>1</mn><mi>w</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mo>∑</mo><mrow><mi>i</mi><mo>:</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow></msub><msub><mi>w</mi><mi>i</mi></msub></mrow></mfrac><msub><mo>∑</mo><mrow><mi>i</mi><mo>:</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow></msub><mrow><msub><mi>w</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub></mrow></mrow><annotation encoding="application/x-tex">\bar{x}_{1w} = \frac{1}{\sum_{i:A_i = 1}{w_i}}\sum_{i:A_i=1}{w_ix_i}</annotation></semantics></math>,
and similarly for the control group. Critically, the standardization
factor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>s</mi><mo>*</mo></msup><annotation encoding="application/x-tex">s^*</annotation></semantics></math>
is the same before and after weighting. I will repeat, <strong>the
standardization factor</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>s</mi><mo>*</mo></msup><annotation encoding="application/x-tex">s^*</annotation></semantics></math>
is the same before and after weighting. I don’t mean it has the same
formula, it mean it is literally the same value. I explain in more
detail in a question below why this is the case.</p>
<p>How is the standardization factor computed? This depends on the
argument to <code>s.d.denom</code> supplied to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> or
<code><a href="../reference/love.plot.html">love.plot()</a></code>. When <code>s.d.denom</code> is not supplied,
this is determined by the argument supplied to <code>estimand</code>,
and when that is not supplied, the estimand is guess based on the form
of the weights, if any. By default, with no weights supplied and no
argument to <code>s.d.denom</code> or <code>estimand</code>,
<code>s.d.denom</code> is set to <code>"pooled"</code>, and a note will
appear saying so. That note doesn’t appear if weights are supplied or
balance is assessed on the output of a another package, as the estimand,
and therefore <code>s.d.denom</code>, can be determined
automatically.</p>
<p>Below are the formulas for the standardization factor corresponding
to each value of <code>s.d.denom</code>:</p>
<ul>
<li>
<code>"pooled"</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mo>*</mo></msup><mo>=</mo><msqrt><mfrac><mrow><msubsup><mi>s</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>s</mi><mn>0</mn><mn>2</mn></msubsup></mrow><mn>2</mn></mfrac></msqrt></mrow><annotation encoding="application/x-tex">s^* = \sqrt{\frac{s_1^2 + s_0^2}{2}}</annotation></semantics></math>
</li>
<li>
<code>"treated"</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mo>*</mo></msup><mo>=</mo><msub><mi>s</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">s^* = s_1</annotation></semantics></math>
</li>
<li>
<code>"control"</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mo>*</mo></msup><mo>=</mo><msub><mi>s</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">s^* = s_0</annotation></semantics></math>
</li>
<li>
<code>"all"</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mo>*</mo></msup><mo>=</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">s^* = s</annotation></semantics></math>
</li>
<li>
<code>"weighted"</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mo>*</mo></msup><mo>=</mo><msub><mi>s</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">s^* = s_w</annotation></semantics></math>
</li>
<li>
<code>"hedges"</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mo>*</mo></msup><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>−</mo><mfrac><mn>3</mn><mrow><mn>4</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>−</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>1</mn></mrow></mfrac></mrow></mfrac><msqrt><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mn>1</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>s</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mn>0</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>s</mi><mn>0</mn><mn>2</mn></msubsup></mrow><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">s^* = \frac{1}{1 - \frac{3}{4(n - 2) - 1}}\sqrt{\frac{(n_1 - 1)s_1^2 + (n_0 - 1)s_0^2}{n - 2}}</annotation></semantics></math>
</li>
</ul>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mn>1</mn></msub><annotation encoding="application/x-tex">s_1</annotation></semantics></math>
is the standard deviation of the treated group,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mn>0</mn></msub><annotation encoding="application/x-tex">s_0</annotation></semantics></math>
is the standard deviation of the control group,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
is the standard deviation of the whole sample ignoring treatment group
membership,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>w</mi></msub><annotation encoding="application/x-tex">s_w</annotation></semantics></math>
is the weighted standard deviation of the whole sample,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>0</mn></msub><annotation encoding="application/x-tex">n_0</annotation></semantics></math>
are sizes of the treated and control groups, respectively, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><msub><mi>n</mi><mn>1</mn></msub><mo>+</mo><msub><mi>n</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">n = n_1 + n_0</annotation></semantics></math>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;For multi-category treatments, all standardization
factors are computed using the full data, not just the groups being
compared. For example, the pooled standard deviation involves computing
the mean of all the group-specific variances, not just the two being
compared. Similarly, in the &lt;code&gt;"hedges"&lt;/code&gt; formula,
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;n-2&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;
is replaced with
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;n-k&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;,
where
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;annotation encoding="application/x-tex"&gt;k&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;
is the number of treatment groups.&lt;/p&gt;'><sup>1</sup></a> For
continuous covariates, the unweighted standard deviation is computed as
usual, i.e., as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><msqrt><mrow><mfrac><mn>1</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></mfrac><munder><mo>∑</mo><mi>i</mi></munder><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">
s = \sqrt{\frac{1}{n-1}\sum_i{(x_i - \bar{x})^2}}
</annotation></semantics></math> and the weighted standard deviation is
computed as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><msqrt><mrow><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub></mrow><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>−</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>w</mi><mi>i</mi><mn>2</mn></msubsup></mrow></mfrac><munder><mo>∑</mo><mi>i</mi></munder><mrow><msub><mi>w</mi><mi>i</mi></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mi>w</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">
s = \sqrt{\frac{\sum_{i} w_{i}}{(\sum_{i} w_{i})^2 - \sum_{i=1}^{n} w^2_{i}}\sum_i{w_i(x_i - \bar{x}_w)^2}}
</annotation></semantics></math>For binary covariates, the unweighted
standard deviation is computed as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><msqrt><mrow><mover><mi>x</mi><mo accent="true">‾</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mover><mi>x</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">s = \sqrt{\bar{x}(1-\bar{x})}</annotation></semantics></math>
and the weighted standard deviation is computed as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><msqrt><mrow><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mi>w</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mover><mi>x</mi><mo accent="true">‾</mo></mover><mi>w</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">s = \sqrt{\bar{x}_w(1-\bar{x}_w)}</annotation></semantics></math>.</p>
<p>When sampling weights are supplied, all standard deviations in the
standardization factor are computed incorporating the sampling weights.
When <code>s.d.denom = "weighted"</code>, the standardization factor is
computed using the weights used to balance the sample (i.e., the
matching or weighting weights), even for the unadjusted sample.
Remember, the standardization is ALWAYS the same before and after
adjustment.</p>
<p>I know some of these formulas seem overly complicated for such simple
statistics, but they are required to keep things consistent and not
dependent on the scale of the weights.</p>
</div>
<div class="section level3">
<h3 id="why-are-mean-differences-not-standardized-for-binary-covariates">Why are mean differences not standardized for binary
covariates?<a class="anchor" aria-label="anchor" href="#why-are-mean-differences-not-standardized-for-binary-covariates"></a>
</h3>
<p>Ultimately, bias in the treatment effect estimate is a function of
imbalance. That bias is indifferent to whether you measure that
imbalance using a standardized or unstandardized mean difference. The
reason we use SMDs is that covariates naturally are on a variety of
different scales, and when trying to quickly assess whether a sample is
balanced, it is productive to unify the scales of the covariates. That
way, balance on a covariate measured with large numbers (e.g., days in
hospital or prior earnings in dollars) can be assessed alongside balance
on a covariate measured with small numbers (e.g., number of
comorbidities or years of education).</p>
<p>With binary covariates, though, they are already on a comprehensible
scale, so there is no need to standardize. In addition, the scale is
intuitive for people; a difference in proportion of .1 when both groups
have 100 people means that there is an imbalance of 10 people on the
covariate. Are 10 people being different enough to cause bias in the
estimate? That can be assessed substantively without needing to take the
additional step of translating the variable’s scale into something
meaningful.</p>
<p>Another important reason why mean difference are not standardized is
that it is possible for two covariates with the same imbalance to have
vastly different mean differences. For example, consider the following
dataset. <code>X1</code> and <code>X2</code> both have a mean difference
of .1; if they both affected the outcome equally, then each would
contribute to the bias in the estimate to the same extent.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">0</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">19</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>,</span>
<span>        binary <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>        disp <span class="op">=</span> <span class="st">"means"</span>,</span>
<span>        s.d.denom <span class="op">=</span> <span class="st">"treated"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">#&gt;      Type M.0.Un M.1.Un Diff.Un</span></span>
<span><span class="co">#&gt; X1 Binary   0.85   0.95     0.1</span></span>
<span><span class="co">#&gt; X2 Binary   0.45   0.55     0.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">#&gt;     Control Treated</span></span>
<span><span class="co">#&gt; All      20      20</span></span></code></pre></div>
<p>But if we standardized the mean differences, not only do we move away
from an actually interpretable statistic (i.e., what does it mean to
divide by the standard deviation of a binary variable?), we see that the
standardized mean difference vary by a huge amount, with <code>X1</code>
having twice the imbalance of <code>X2</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>,</span>
<span>        binary <span class="op">=</span> <span class="st">"std"</span>,</span>
<span>        s.d.denom <span class="op">=</span> <span class="st">"treated"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">#&gt;      Type Diff.Un</span></span>
<span><span class="co">#&gt; X1 Binary  0.4588</span></span>
<span><span class="co">#&gt; X2 Binary  0.2010</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">#&gt;     Control Treated</span></span>
<span><span class="co">#&gt; All      20      20</span></span></code></pre></div>
<p>Why does this happen? The standard deviation of a binary variable is
a function of its mean (in particular, it is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><msqrt><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">s = \sqrt{p(1-p)}</annotation></semantics></math>)
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is the mean of the variable). That means information about the mean of
the variable, which is unrelated to imbalance, contaminates the
standardized mean difference, which is supposed to measure imbalance. In
this case, standardizing the mean difference only adds confusion and
reduces interpretability. That is why, by default, mean differences for
binary variables are unstandardized by default.</p>
<p>You can always change this by setting <code>binary = "std"</code> in
the call to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> or setting
<code>set.cobalt.options(binary = "std")</code> to change the option for
the whole session. One advantage of using standardized mean differences
for binary variables is that they are always larger than the raw mean
difference (because the standardization factor is always less than 1),
which means if you use the standardized mean difference as your balance
criterion, you will always seek better balance than using the raw mean
differences. The balance statistics computed by
<code><a href="../reference/bal.compute.html">bal.compute()</a></code> that involve the standardized mean difference
standardize all variables, including binary variables.</p>
</div>
<div class="section level3">
<h3 id="why-do-you-use-the-same-standardization-factor-before-and-after-adjustment">Why do you use the same standardization factor before and after
adjustment?<a class="anchor" aria-label="anchor" href="#why-do-you-use-the-same-standardization-factor-before-and-after-adjustment"></a>
</h3>
<p>It is important to remember that bias is a function of the difference
in means of a covariate and standardization is a tool to aid in balance
assessment. As a tool, it should reflect imbalance accurately (i.e.,
without incorporating extraneous information), but there is no
statistical “truth” about the nature of the standardization factor. I
use the same standardization factor before and after adjustment as
recommended by <span class="citation">Stuart (<a href="#ref-stuartDevelopingPracticalRecommendations2008">2008</a>)</span>.
The rationale is that by isolating the SMD to reflect changes in the
difference in means, why can more accurately assess improvement in
balance rather than combining information about the difference in means
with information about the variability of the covariate, which may
change in a variety of ways after adjustment. I describe a specific
example of how allowing the standardization factor to change can cause
problems <a href="https://stats.stackexchange.com/a/565705/116195" class="external-link">here</a>.</p>
</div>
<div class="section level3">
<h3 id="how-do-i-extract-the-balance-tables-from-the-bal-tab-object">How do I extract the balance tables from the <code>bal.tab()</code>
object?<a class="anchor" aria-label="anchor" href="#how-do-i-extract-the-balance-tables-from-the-bal-tab-object"></a>
</h3>
<p>The output of a call to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> is a
<code>bal.tab</code> object, which has several components depending on
the features of the dataset (e.g., whether the data are multiply imputed
or clustered or whether the treatment is binary or multi-category,
etc.). In the most basic case, a binary or continuous treatment with no
clustering, no multiple imputations, a single time point, and
subclassification is not used, the balance table is stored in the
<code>Balance</code> component of the output object. Let’s take a
look:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span>,</span>
<span>             data <span class="op">=</span> <span class="va">lalonde</span>, s.d.denom <span class="op">=</span> <span class="st">"treated"</span>,</span>
<span>             disp <span class="op">=</span> <span class="st">"means"</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"v"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the structure of the object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">b</span>, give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ Balance     :'data.frame':    7 obs. of  9 variables:</span></span>
<span><span class="co">#&gt;   ..$ Type       : chr [1:7] "Contin." "Contin." "Binary" "Binary" ...</span></span>
<span><span class="co">#&gt;   ..$ M.0.Un     : num [1:7] 28.03 10.235 0.203 0.142 0.655 ...</span></span>
<span><span class="co">#&gt;   ..$ M.1.Un     : num [1:7] 25.8162 10.3459 0.8432 0.0595 0.0973 ...</span></span>
<span><span class="co">#&gt;   ..$ Diff.Un    : num [1:7] -0.3094 0.055 0.6404 -0.0827 -0.5577 ...</span></span>
<span><span class="co">#&gt;   ..$ V.Ratio.Un : num [1:7] 0.44 0.496 NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..$ M.0.Adj    : num [1:7] NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt;   ..$ M.1.Adj    : num [1:7] NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt;   ..$ Diff.Adj   : num [1:7] NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt;   ..$ V.Ratio.Adj: num [1:7] NA NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt;  $ Observations:'data.frame':    1 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ Control: num 429</span></span>
<span><span class="co">#&gt;   ..$ Treated: num 185</span></span>
<span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Balance</span></span>
<span><span class="co">#&gt;                Type       M.0.Un       M.1.Un     Diff.Un V.Ratio.Un M.0.Adj</span></span>
<span><span class="co">#&gt; age         Contin.   28.0303030 2.581622e+01 -0.30944526  0.4399955      NA</span></span>
<span><span class="co">#&gt; educ        Contin.   10.2354312 1.034595e+01  0.05496466  0.4958934      NA</span></span>
<span><span class="co">#&gt; race_black   Binary    0.2027972 8.432432e-01  0.64044604         NA      NA</span></span>
<span><span class="co">#&gt; race_hispan  Binary    0.1421911 5.945946e-02 -0.08273168         NA      NA</span></span>
<span><span class="co">#&gt; race_white   Binary    0.6550117 9.729730e-02 -0.55771436         NA      NA</span></span>
<span><span class="co">#&gt; married      Binary    0.5128205 1.891892e-01 -0.32363132         NA      NA</span></span>
<span><span class="co">#&gt; re74        Contin. 5619.2365064 2.095574e+03 -0.72108381  0.5181285      NA</span></span>
<span><span class="co">#&gt;             M.1.Adj Diff.Adj V.Ratio.Adj</span></span>
<span><span class="co">#&gt; age              NA       NA          NA</span></span>
<span><span class="co">#&gt; educ             NA       NA          NA</span></span>
<span><span class="co">#&gt; race_black       NA       NA          NA</span></span>
<span><span class="co">#&gt; race_hispan      NA       NA          NA</span></span>
<span><span class="co">#&gt; race_white       NA       NA          NA</span></span>
<span><span class="co">#&gt; married          NA       NA          NA</span></span>
<span><span class="co">#&gt; re74             NA       NA          NA</span></span></code></pre></div>
<p>It’s not a very pretty object, which is why the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>
method makes it look nicer. If you are willing to process this table
yourself, you can easily extract it from the <code><a href="../reference/bal.tab.html">bal.tab()</a></code>
output and do what you want with it, e.g., saving it to a CSV file or
making a pretty table using another package. Although I have been
working on a way to do this more easily (i.e., to create a
publication-ready table from a <code>bal.tab</code> object), it might be
a while because the main purpose of this package is balance assessment,
not formatting for publication (although I did put a lot of work into
<code><a href="../reference/love.plot.html">love.plot()</a></code> to make it customizable for publication).</p>
</div>
<div class="section level3">
<h3 id="how-are-balance-statistics-computed-when-using-subclassification">How are balance statistics computed when using
subclassification?<a class="anchor" aria-label="anchor" href="#how-are-balance-statistics-computed-when-using-subclassification"></a>
</h3>
<p>Subclassification involves creating strata (usually based on the
propensity score), within which covariates are ideally balanced.
<code><a href="../reference/bal.tab.html">bal.tab()</a></code> lets you assess balance both within and across
subclasses.</p>
<p>One must always remember that the standardized mean difference uses
the standardization factor computed in the original sample, i.e., prior
to subclassification. Let’s take a look below using
<code>MatchIt</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PS Subclassification</span></span>
<span><span class="va">msub</span> <span class="op">&lt;-</span> <span class="fu">MatchIt</span><span class="fu">::</span><span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span>,</span>
<span>                         data <span class="op">=</span> <span class="va">lalonde</span>, method <span class="op">=</span> <span class="st">"subclass"</span>,</span>
<span>                         estimand <span class="op">=</span> <span class="st">"ATE"</span>, min.n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Balance in the first subclass</span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">msub</span>, which.sub <span class="op">=</span> <span class="fl">1</span>, binary <span class="op">=</span> <span class="st">"std"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Balance by subclass</span></span></span>
<span><span class="co">#&gt;  - - - <span style="font-style: italic;">Subclass 1</span> - - - </span></span>
<span><span class="co">#&gt;                 Type Diff.Adj</span></span>
<span><span class="co">#&gt; distance    Distance   0.1574</span></span>
<span><span class="co">#&gt; age          Contin.  -1.0433</span></span>
<span><span class="co">#&gt; educ         Contin.  -0.2759</span></span>
<span><span class="co">#&gt; race_black    Binary   0.0000</span></span>
<span><span class="co">#&gt; race_hispan   Binary   0.0000</span></span>
<span><span class="co">#&gt; race_white    Binary   0.0000</span></span>
<span><span class="co">#&gt; married       Binary  -1.1135</span></span>
<span><span class="co">#&gt; re74         Contin.  -1.8353</span></span></code></pre></div>
<p>Let’s see where the number <code>-1.0433</code> came from (the
standardized mean difference for <code>age</code>). We compute the mean
of <code>age</code> in each treatment group in subclass 1, and then
divide it by the pooled standard deviation of age (because we requested
the ATE) in <em>the original sample</em>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">msub</span><span class="op">$</span><span class="va">subclass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">msub</span><span class="op">$</span><span class="va">subclass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">m1</span> <span class="op">-</span> <span class="va">m0</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">s1</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">s0</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.043294</span></span></code></pre></div>
<p>A common mistake is to compute the standard deviation within each
subclass. There are a few reasons why this is bad: 1) it suffers from
the same problem that changing the standardization factor does with
matching or weighting, i.e., that balance can appear to be worse because
the standardization factor shrank even as the means got closer together;
2) when there is no or little variation of a covariate within a
subclass, which is desirable, the standardization factor will be tiny,
making the SMD potentially appear huge; and 3) the same variable will
use different standardization factors across subclasses, which means the
same difference in means, which contribute to bias equally, will have
different balance statistics.</p>
<p>A related question is how the balance statistics are computed across
subclasses to compute an overall balance statistic for the sample. For
(standardized) mean differences, it is as easy as computing the average
of the statistic across subclasses, where the statistics are weighted
corresponding to the number of units in the subclass in the target group
(e.g., the treated units for the ATT, all units for the ATE, etc.).
Below I’ll demonstrate how to do that manually for the <code>age</code>
covariate:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SMDs across subclasses for age</span></span>
<span><span class="va">smds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">msub</span><span class="op">$</span><span class="va">subclass</span> <span class="op">==</span> <span class="va">s</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">msub</span><span class="op">$</span><span class="va">subclass</span> <span class="op">==</span> <span class="va">s</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">s0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="op">(</span><span class="va">m1</span> <span class="op">-</span> <span class="va">m0</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">s1</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">s0</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample size in each subclass</span></span>
<span><span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">msub</span><span class="op">$</span><span class="va">subclass</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary SMD for age</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">smds</span>, <span class="va">ns</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.2354095</span></span>
<span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">msub</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Balance measures across subclasses</span></span></span>
<span><span class="co">#&gt;                 Type Diff.Adj</span></span>
<span><span class="co">#&gt; distance    Distance   0.1081</span></span>
<span><span class="co">#&gt; age          Contin.  -0.2354</span></span>
<span><span class="co">#&gt; educ         Contin.   0.0075</span></span>
<span><span class="co">#&gt; race_black    Binary   0.0535</span></span>
<span><span class="co">#&gt; race_hispan   Binary  -0.0420</span></span>
<span><span class="co">#&gt; race_white    Binary  -0.0115</span></span>
<span><span class="co">#&gt; married       Binary  -0.1160</span></span>
<span><span class="co">#&gt; re74         Contin.  -0.3200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Sample sizes by subclass</span></span></span>
<span><span class="co">#&gt;           1   2  3   4   5   6 All</span></span>
<span><span class="co">#&gt; Control 102 100 88  72  39  28 429</span></span>
<span><span class="co">#&gt; Treated   4   4  9  30  62  76 185</span></span>
<span><span class="co">#&gt; Total   106 104 97 102 101 104 614</span></span></code></pre></div>
<p>This works for mean differences but not other statistics. So the way
<code>cobalt</code> actually does this is compute stratification
weights, and then compute the balance statistics using the
stratification weights in the full sample. Stratification weights are
first computed by computing the proportion of treated units in each
sample, and then using the formulas to compute propensity score weights
from propensity scores. Here’s how I do that manually for
<code>age</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute proportion of treated units in each subclass</span></span>
<span><span class="va">prop1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span><span class="op">[</span><span class="va">msub</span><span class="op">$</span><span class="va">subclass</span> <span class="op">==</span> <span class="va">s</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign to each unit</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="va">prop1</span><span class="op">[</span><span class="va">msub</span><span class="op">$</span><span class="va">subclass</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Compute ATE weights</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">ps</span>, <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ps</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute weighted KS statistic</span></span>
<span><span class="fu"><a href="../reference/balance-summary.html">col_w_ks</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span>, treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>         weights <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1658923</span></span>
<span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">msub</span>, stats <span class="op">=</span> <span class="st">"ks"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Balance measures across subclasses</span></span></span>
<span><span class="co">#&gt;                 Type KS.Adj</span></span>
<span><span class="co">#&gt; distance    Distance 0.2187</span></span>
<span><span class="co">#&gt; age          Contin. 0.1659</span></span>
<span><span class="co">#&gt; educ         Contin. 0.0627</span></span>
<span><span class="co">#&gt; race_black    Binary 0.0535</span></span>
<span><span class="co">#&gt; race_hispan   Binary 0.0420</span></span>
<span><span class="co">#&gt; race_white    Binary 0.0115</span></span>
<span><span class="co">#&gt; married       Binary 0.1160</span></span>
<span><span class="co">#&gt; re74         Contin. 0.3038</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Sample sizes by subclass</span></span></span>
<span><span class="co">#&gt;           1   2  3   4   5   6 All</span></span>
<span><span class="co">#&gt; Control 102 100 88  72  39  28 429</span></span>
<span><span class="co">#&gt; Treated   4   4  9  30  62  76 185</span></span>
<span><span class="co">#&gt; Total   106 104 97 102 101 104 614</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="why-dont-i-get-the-same-balance-statistics-when-using-cobalt-as-i-do-when-using-tableone">Why don’t I get the same balance statistics when using
<code>cobalt</code> as I do when using <code>tableone</code>?<a class="anchor" aria-label="anchor" href="#why-dont-i-get-the-same-balance-statistics-when-using-cobalt-as-i-do-when-using-tableone"></a>
</h3>
<p><code>tableone</code> is another package that provides tools for
balance assessment. One strength that the package has is its beautiful,
publication-ready tables that include summary statistics for the
covariates, clean variable names, and clean headings. But it does not
incorporate best practices in balance assessment in favor of
transparency. This differs from the ethos of <code>cobalt</code>, which
is to provide highly customizable balance statistics that reflect best
practices and use well-reasoned decisions. This is not an insult to
<code>tableone</code> but is meant to reflect the different purposes
<code>cobalt</code> and <code>tableone</code> have. They should not be
used interchangeably or expect to yield identical results because they
use different formulas for computing certain statistics, most notably
the SMD.</p>
<p>Below are some of the reasons why SMDs might differ between
<code>tableone</code> and <code>cobalt</code>:</p>
<ul>
<li>
<code>tableone</code> always uses the pooled standard deviation
(i.e., the standardizaton factor setting
<code>s.d.denom = "pooled"</code>) as the standardization factor, while
<code>cobalt</code> determines the standardization factor based on the
estimand (though by default or when the ATE is the estimand, the two
should be aligned).</li>
<li>
<code>tableone</code> uses the weighted standardization factor in
the SMD, whereas <code>cobalt</code> always uses the standardization
factor computed in the unadjusted sample. For matching, this means
<code>tableone</code> computes the standardization factor in the matched
sample, while <code>cobalt</code> uses the original sample.</li>
<li>
<code>tableone</code> uses <code><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">survey::svyvar()</a></code> to compute
weighted variances, whereas <code>cobalt</code> uses the formula
described previously (and implemented in <code><a href="../reference/balance-summary.html">col_w_sd()</a></code>). These
values will differ by small amounts when the weights are not
constant.</li>
<li>For multi-category covariates, <code>tableone</code> uses a single
statistic described by <span class="citation">Yang and Dalton (<a href="#ref-yangUnifiedApproachMeasuring2012">2012</a>)</span> to
summarize balance, whereas <code>cobalt</code> provides a balance
statistic for each level of the covariate. There is no reason to prefer
the statistic used by <code>tableone</code>; it does not have any
relationship to the bias of the estimate and can mask large differences
in some categories when there are many categories. See <a href="https://stats.stackexchange.com/a/496608/116195" class="external-link">here</a> for a
more detailed answer.</li>
</ul>
<p>In practice, these differences will be small. Obviously, I recommend
using <code>cobalt</code> instead for balance assessment, and I
recommend reporting the balance statistics <code>cobalt</code> produces.
That said, if you understand what <code>tableone</code> is doing and are
okay with the choices it makes, there is no denying that it can produce
beautiful tables.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-stuartDevelopingPracticalRecommendations2008" class="csl-entry">
Stuart, Elizabeth A. 2008. <span>“Developing Practical Recommendations
for the Use of Propensity Scores: Discussion of <span>‘<span>A</span>
Critical Appraisal of Propensity Score Matching in the Medical
Literature Between 1996 and 2003’</span> by <span>Peter Austin</span>,
<span>Statistics</span> in <span>Medicine</span>.”</span> <em>Statistics
in Medicine</em> 27 (12): 2062–65. <a href="https://doi.org/10.1002/sim.3207" class="external-link">https://doi.org/10.1002/sim.3207</a>.
</div>
<div id="ref-yangUnifiedApproachMeasuring2012" class="csl-entry">
Yang, Dongsheng, and Jarrod E Dalton. 2012. <span>“A Unified Approach to
Measuring the Effect Size Between Two Groups Using SAS®,”</span> 6.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
