<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using cobalt with Longitudinal Treatments • cobalt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using cobalt with Longitudinal Treatments">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cobalt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/cobalt.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/other-packages.html">Using cobalt with Other Preprocessing Packages</a></li>
    <li><a class="dropdown-item" href="../articles/segmented-data.html">Using cobalt with Clustered, Multiply Imputed, and Other Segmented Data</a></li>
    <li><a class="dropdown-item" href="../articles/longitudinal-treat.html">Using cobalt with Longitudinal Treatments</a></li>
    <li><a class="dropdown-item" href="../articles/love.plot.html">Using `love.plot()` To Generate Love Plots</a></li>
    <li><a class="dropdown-item" href="../articles/optimizing-balance.html">Optimizing Tuning Parameters for Balance</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/cobalt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using cobalt with Longitudinal Treatments</h1>
                        <h4 data-toc-skip class="author">Noah
Greifer</h4>
            
            <h4 data-toc-skip class="date">2026-01-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/cobalt/blob/master/vignettes/longitudinal-treat.Rmd" class="external-link"><code>vignettes/longitudinal-treat.Rmd</code></a></small>
      <div class="d-none name"><code>longitudinal-treat.Rmd</code></div>
    </div>

    
    
<p>This is an introduction to the use of <em>cobalt</em> with
longitudinal treatments. These occur when there are multiple treatment
periods spaced over time, with the potential for time-dependent
confounding to occur. A common way to estimate treatment effects in
these scenarios is to use marginal structural models (MSM), weighted by
balancing weights. The goal of applying weights is to simulate a
sequential randomization design, where the probability of being assigned
to treatment at each time point is independent of each unit’s prior
covariate and treatment history. For introduction to MSMs in general,
see <span class="citation">Thoemmes and Ong (<a href="#ref-thoemmesPrimerInverseProbability2016">2016</a>)</span>, <span class="citation">VanderWeele, Jackson, and Li (<a href="#ref-vanderweeleCausalInferenceLongitudinal2016">2016</a>)</span>,
<span class="citation">Cole and Hernán (<a href="#ref-coleConstructingInverseProbability2008">2008</a>)</span>, or
<span class="citation">Robins, Hernán, and Brumback (<a href="#ref-robinsMarginalStructuralModels2000">2000</a>)</span>. The key
issue addressed by this guide and <em>cobalt</em> in general is
assessing balance before each treatment period to ensure the removal of
confounding.</p>
<p>In preprocessing for MSMs, three types of variables are relevant:
baseline covariates, treatments, and intermediate outcomes/time-varying
covariates. The goal of balance assessment is to assess whether after
preprocessing, the resulting sample is one in which each treatment is
independent of baseline covariates, treatment history, and time-varying
covariates. The tools in <em>cobalt</em> have been developed to satisfy
these goals.</p>
<p>The next section describe how to use <em>cobalt</em>’s tools to
assess balance with longitudinal treatments. First, we’ll examine an
example data set and identify some tools that can be used to generate
weights for MSMs. Next we’ll use <code><a href="../reference/bal.tab.html">bal.tab()</a></code>,
<code><a href="../reference/bal.plot.html">bal.plot()</a></code>, and <code><a href="../reference/love.plot.html">love.plot()</a></code> to assess and
present balance.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We’re going to use the <code>msmdata</code> data set in the
<em>WeightIt</em> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/cobalt/">"cobalt"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/WeightIt/" class="external-link">"WeightIt"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"msmdata"</span>, package <span class="op">=</span> <span class="st">"WeightIt"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">msmdata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   X1_0 X2_0 A_1 X1_1 X2_1 A_2 X1_2 X2_2 A_3 Y_B</span></span>
<span><span class="co">## 1    2    0   1    5    1   0    4    1   0   0</span></span>
<span><span class="co">## 2    4    0   1    9    0   1   10    0   1   1</span></span>
<span><span class="co">## 3    4    1   0    5    0   1    4    0   0   1</span></span>
<span><span class="co">## 4    4    1   0    4    0   0    6    1   0   1</span></span>
<span><span class="co">## 5    6    1   1    5    0   1    6    0   0   1</span></span>
<span><span class="co">## 6    5    1   0    4    0   1    4    0   1   0</span></span></code></pre>
<p>We have the variables <code>Y_B</code>, the outcome;
<code>X1_0</code> and <code>X2_0</code>, the baseline covariates;
<code>X1_1</code> and <code>X2_1</code>, time-varying covariates
measured after treatment period 1; <code>X1_1</code> and
<code>X2_1</code>, covariates measured after treatment period 2; and
<code>A_1</code>, <code>A_2</code>, and <code>A_3</code>, the treatments
at each of the three treatment periods.</p>
<p>The goal of balance assessment in this scenario is to ensure the
following:</p>
<ol style="list-style-type: decimal">
<li>
<code>A_1</code> is independent from <code>X1_0</code> and
<code>X2_0</code>
</li>
<li>
<code>A_2</code> is independent from <code>X1_0</code>,
<code>X2_0</code>, <code>A_1,</code>X1_1<code>, and</code>X2_1`</li>
<li>
<code>tx3</code> is independent from <code>X1_0</code>,
<code>X2_0</code>,
<code>A_1,</code>X1_1<code>,</code>X2_1<code>,</code>A_2,
<code>X1_2</code>, and <code>X2_2</code>
</li>
</ol>
<p>Note these conditions are different from and weaker than those
described by <span class="citation">Jackson (<a href="#ref-jacksonDiagnosticsConfoundingTimevarying2016">2016</a>)</span>.
See his <code>confoundr</code> package for implementing the diagnostics
he describes.</p>
</div>
<div class="section level2">
<h2 id="bal-tab">
<code>bal.tab()</code><a class="anchor" aria-label="anchor" href="#bal-tab"></a>
</h2>
<p>To examine balance on the original data, we can specify the
treatment-covariate relationship we want to assess by using either the
formula or data frame interfaces to <code><a href="../reference/bal.tab.html">bal.tab()</a></code>. The formula
interface requires a list of formulas, one for each treatment, and a
data set containing the relevant variables. The data set must be in the
“wide” setup, where each time point receives its own columns and each
unit has exactly one row of data. The formula interface is similar to
the <em>WeightIt</em> input seen above. The data frame interface
requires a list of treatment values for each time point and a data frame
or list of covariates for each time point. We’ll use the formula
interface here.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A_1</span> <span class="op">~</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span>,</span>
<span>             <span class="va">A_2</span> <span class="op">~</span> <span class="va">X1_1</span> <span class="op">+</span> <span class="va">X2_1</span> <span class="op">+</span></span>
<span>               <span class="va">A_1</span> <span class="op">+</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span>,</span>
<span>             <span class="va">A_3</span> <span class="op">~</span> <span class="va">X1_2</span> <span class="op">+</span> <span class="va">X2_2</span> <span class="op">+</span></span>
<span>               <span class="va">A_2</span> <span class="op">+</span> <span class="va">X1_1</span> <span class="op">+</span> <span class="va">X2_1</span> <span class="op">+</span></span>
<span>               <span class="va">A_1</span> <span class="op">+</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">msmdata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance summary across all time points</span></span></span>
<span><span class="co">##        Times    Type Max.Diff.Un</span></span>
<span><span class="co">## X1_0 1, 2, 3 Contin.      0.6897</span></span>
<span><span class="co">## X2_0 1, 2, 3  Binary      0.3253</span></span>
<span><span class="co">## X1_1    2, 3 Contin.      0.8736</span></span>
<span><span class="co">## X2_1    2, 3  Binary      0.2994</span></span>
<span><span class="co">## A_1     2, 3  Binary      0.1267</span></span>
<span><span class="co">## X1_2       3 Contin.      0.4749</span></span>
<span><span class="co">## X2_2       3  Binary      0.5945</span></span>
<span><span class="co">## A_2        3  Binary      0.1620</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 1</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All    3306    4194</span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 2</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All    3701    3799</span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 3</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All    4886    2614</span></span></code></pre>
<p>Here we see a summary of balance across all time points. This
displays each variable, how many times it appears in balance tables, its
type, and the greatest imbalance for that variable across all time
points. Below this is a summary of sample sizes across time points. To
request balance on individual time points, we can use the
<code>which.time</code> argument, which can be set to one or more
numbers or <code>.all</code> or <code>.none</code> (the default). Below
we’ll request balance on all time points by setting
<code>which.time = .all</code>. Doing so hides the balance summary
across time points, but this can be requested again by setting
<code>msm.summary = TRUE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A_1</span> <span class="op">~</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span>,</span>
<span>             <span class="va">A_2</span> <span class="op">~</span> <span class="va">X1_1</span> <span class="op">+</span> <span class="va">X2_1</span> <span class="op">+</span></span>
<span>               <span class="va">A_1</span> <span class="op">+</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span>,</span>
<span>             <span class="va">A_3</span> <span class="op">~</span> <span class="va">X1_2</span> <span class="op">+</span> <span class="va">X2_2</span> <span class="op">+</span></span>
<span>               <span class="va">A_2</span> <span class="op">+</span> <span class="va">X1_1</span> <span class="op">+</span> <span class="va">X2_1</span> <span class="op">+</span></span>
<span>               <span class="va">A_1</span> <span class="op">+</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">msmdata</span>,</span>
<span>        which.time <span class="op">=</span> <span class="va">.all</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance by Time Point</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 1</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##         Type Diff.Un</span></span>
<span><span class="co">## X1_0 Contin.  0.6897</span></span>
<span><span class="co">## X2_0  Binary -0.3253</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All    3306    4194</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 2</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##         Type Diff.Un</span></span>
<span><span class="co">## X1_1 Contin.  0.8736</span></span>
<span><span class="co">## X2_1  Binary -0.2994</span></span>
<span><span class="co">## A_1   Binary  0.1267</span></span>
<span><span class="co">## X1_0 Contin.  0.5276</span></span>
<span><span class="co">## X2_0  Binary -0.0599</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All    3701    3799</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 3</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##         Type Diff.Un</span></span>
<span><span class="co">## X1_2 Contin.  0.4749</span></span>
<span><span class="co">## X2_2  Binary -0.5945</span></span>
<span><span class="co">## A_2   Binary  0.1620</span></span>
<span><span class="co">## X1_1 Contin.  0.5727</span></span>
<span><span class="co">## X2_1  Binary -0.0405</span></span>
<span><span class="co">## A_1   Binary  0.1000</span></span>
<span><span class="co">## X1_0 Contin.  0.3614</span></span>
<span><span class="co">## X2_0  Binary -0.0402</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All    4886    2614</span></span>
<span><span class="co">##  - - - - - - - - - - -</span></span></code></pre>
<p>Here we see balance by time point. At each time point, a
<code>bal.tab</code> object is produced for that time point. These
function just like regular <code>bal.tab</code> objects.</p>
<p>This output will appear no matter what the treatment types are (i.e.,
binary, continuous, multi-category), but for multi-category treatments
or when the treatment types vary or for multiply imputed data, no
balance summary will be computed or displayed.</p>
<p>To estimate the weights, we’ll use
<code><a href="https://ngreifer.github.io/WeightIt/reference/weightitMSM.html" class="external-link">WeightIt::weightitMSM()</a></code> to fit a series of logistic
regressions that generate the weights. See the <em>WeightIt</em>
documentation for more information on how to use <em>WeightIt</em> with
longitudinal treatments.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Wmsm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightitMSM.html" class="external-link">weightitMSM</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A_1</span> <span class="op">~</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span>,</span>
<span>                         <span class="va">A_2</span> <span class="op">~</span> <span class="va">X1_1</span> <span class="op">+</span> <span class="va">X2_1</span> <span class="op">+</span></span>
<span>                           <span class="va">A_1</span> <span class="op">+</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span>,</span>
<span>                         <span class="va">A_3</span> <span class="op">~</span> <span class="va">X1_2</span> <span class="op">+</span> <span class="va">X2_2</span> <span class="op">+</span></span>
<span>                           <span class="va">A_2</span> <span class="op">+</span> <span class="va">X1_1</span> <span class="op">+</span> <span class="va">X2_1</span> <span class="op">+</span></span>
<span>                           <span class="va">A_1</span> <span class="op">+</span> <span class="va">X1_0</span> <span class="op">+</span> <span class="va">X2_0</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">msmdata</span><span class="op">)</span></span></code></pre></div>
<p>We can use <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with the <code>weightitMSM</code>
object generated above. Setting <code>un = TRUE</code> would produce
balance statistics before adjustment, like we did before. We’ll set
<code>which.time = .all</code> and <code>msm.summary = TRUE</code> to
see balance for each time point and across time points.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">Wmsm</span>, un <span class="op">=</span> <span class="cn">TRUE</span>, which.time <span class="op">=</span> <span class="va">.all</span>, msm.summary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance by Time Point</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 1</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##         Type Diff.Un Diff.Adj</span></span>
<span><span class="co">## X1_0 Contin.  0.6897   0.0026</span></span>
<span><span class="co">## X2_0  Binary -0.3253  -0.0239</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted 3306.    4194. </span></span>
<span><span class="co">## Adjusted    845.79   899.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 2</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##         Type Diff.Un Diff.Adj</span></span>
<span><span class="co">## X1_1 Contin.  0.8736   0.0531</span></span>
<span><span class="co">## X2_1  Binary -0.2994  -0.0299</span></span>
<span><span class="co">## A_1   Binary  0.1267   0.0065</span></span>
<span><span class="co">## X1_0 Contin.  0.5276   0.0183</span></span>
<span><span class="co">## X2_0  Binary -0.0599  -0.0299</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted 3701.   3799.  </span></span>
<span><span class="co">## Adjusted    912.87  829.87</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 3</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##         Type Diff.Un Diff.Adj</span></span>
<span><span class="co">## X1_2 Contin.  0.4749   0.0643</span></span>
<span><span class="co">## X2_2  Binary -0.5945   0.0096</span></span>
<span><span class="co">## A_2   Binary  0.1620  -0.0054</span></span>
<span><span class="co">## X1_1 Contin.  0.5727   0.0657</span></span>
<span><span class="co">## X2_1  Binary -0.0405  -0.0248</span></span>
<span><span class="co">## A_1   Binary  0.1000  -0.0262</span></span>
<span><span class="co">## X1_0 Contin.  0.3614   0.0342</span></span>
<span><span class="co">## X2_0  Binary -0.0402   0.0147</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted 4886.   2614.  </span></span>
<span><span class="co">## Adjusted   1900.26  600.12</span></span>
<span><span class="co">##  - - - - - - - - - - - </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance summary across all time points</span></span></span>
<span><span class="co">##        Times    Type Max.Diff.Un Max.Diff.Adj</span></span>
<span><span class="co">## X1_0 1, 2, 3 Contin.      0.6897       0.0342</span></span>
<span><span class="co">## X2_0 1, 2, 3  Binary      0.3253       0.0299</span></span>
<span><span class="co">## X1_1    2, 3 Contin.      0.8736       0.0657</span></span>
<span><span class="co">## X2_1    2, 3  Binary      0.2994       0.0299</span></span>
<span><span class="co">## A_1     2, 3  Binary      0.1267       0.0262</span></span>
<span><span class="co">## X1_2       3 Contin.      0.4749       0.0643</span></span>
<span><span class="co">## X2_2       3  Binary      0.5945       0.0096</span></span>
<span><span class="co">## A_2        3  Binary      0.1620       0.0054</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 1</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted 3306.    4194. </span></span>
<span><span class="co">## Adjusted    845.79   899.4</span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 2</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted 3701.   3799.  </span></span>
<span><span class="co">## Adjusted    912.87  829.87</span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 3</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted 4886.   2614.  </span></span>
<span><span class="co">## Adjusted   1900.26  600.12</span></span></code></pre>
<p>Note that to add covariates, we must use <code>addl.list</code>
(which can be abbreviated as <code>addl</code>), which functions like
<code>addl</code> in point treatments. The input to
<code>addl.list</code> must be a list of covariates for each time point,
or a single data data frame of variables to be assessed at all time
points. The same goes for adding distance variables, which must be done
with <code>distance.list</code> (which can be abbreviated as
<code>distance</code>).</p>
<p>Next we’ll use <code><a href="../reference/bal.plot.html">bal.plot()</a></code> to more finely examine
covariate balance.</p>
</div>
<div class="section level2">
<h2 id="bal-plot">
<code>bal.plot()</code><a class="anchor" aria-label="anchor" href="#bal-plot"></a>
</h2>
<p>We can compare distributions of covariates across treatment groups
for each time point using <code><a href="../reference/bal.plot.html">bal.plot()</a></code>, just as we could with
point treatments.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.plot.html">bal.plot</a></span><span class="op">(</span><span class="va">Wmsm</span>, var.name <span class="op">=</span> <span class="st">"X1_0"</span>, which <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>         type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="longitudinal-treat_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="480"></p>
<p>Balance for variables that only appear in certain time points will
only be displayed at those time points:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.plot.html">bal.plot</a></span><span class="op">(</span><span class="va">Wmsm</span>, var.name <span class="op">=</span> <span class="st">"X2_1"</span>, which <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="longitudinal-treat_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="" width="480"></p>
<p>As with <code><a href="../reference/bal.tab.html">bal.tab()</a></code>, <code>which.time</code> can be
specified to limit output to chosen time points.</p>
<p>Finally, we’ll examine using <code><a href="../reference/love.plot.html">love.plot()</a></code> with
longitudinal treatments to display balance for presentation.</p>
</div>
<div class="section level2">
<h2 id="love-plot">
<code>love.plot()</code><a class="anchor" aria-label="anchor" href="#love-plot"></a>
</h2>
<p><code><a href="../reference/love.plot.html">love.plot()</a></code> works with longitudinal treatments just as
it does with point treatments, except that the user can choose whether
to display separate plots for each time point or one plot with the
summary across time points. As with <code><a href="../reference/bal.tab.html">bal.tab()</a></code>, the user can
set <code>which.time</code> to display only certain time points,
including setting it to <code>.all</code> to display all time points
(note that not all variables will be present in all time points). When
set to <code>.none</code> (the default), the summary across time points
is displayed. The <code>agg.fun</code> argument is set to
<code>"max"</code> by default.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/love.plot.html">love.plot</a></span><span class="op">(</span><span class="va">Wmsm</span>, binary <span class="op">=</span> <span class="st">"std"</span><span class="op">)</span></span></code></pre></div>
<p><img src="longitudinal-treat_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="" width="480"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/love.plot.html">love.plot</a></span><span class="op">(</span><span class="va">Wmsm</span>, binary <span class="op">=</span> <span class="st">"std"</span>, which.time <span class="op">=</span> <span class="va">.all</span><span class="op">)</span></span></code></pre></div>
<p><img src="longitudinal-treat_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="480"></p>
</div>
<div class="section level2">
<h2 id="other-packages">Other Packages<a class="anchor" aria-label="anchor" href="#other-packages"></a>
</h2>
<p>Here we used <em>WeightIt</em> to generate our MSM weights, but
<em>cobalt</em> is compatible with other packages for longitudinal
treatments as well. <code>CBMSM</code> objects from the <em>CBPS</em>
package and <code>iptw</code> objects from the <em>twang</em> package
can be used in place of the <code>weightitMSM</code> object in the above
examples. In addition, users who have generated balancing weights
outside any of these package can specify an argument to
<code>weights</code> in <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with the formula or data
frame methods to assess balance using those weights, or they can use the
default method of <code><a href="../reference/bal.tab.html">bal.tab()</a></code> to supply an object containing
any of the objects required for balance assessment.</p>
<p>Note that <em>CBPS</em> estimates and assesses balance on MSM weights
differently from <em>twang</em> and <em>cobalt</em>. Its focus is on
ensuring balance across all treatment history permutations, whereas
<em>cobalt</em> focuses on evaluating the similarity to sequential
randomization. For this reason, it may appear that <code>CBMSM</code>
objects have different balance qualities as measured by the two
packages.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-coleConstructingInverseProbability2008" class="csl-entry">
Cole, Stephen R., and Miguel A Hernán. 2008. <span>“Constructing
<span>Inverse Probability Weights</span> for <span>Marginal Structural
Models</span>.”</span> <em>American Journal of Epidemiology</em> 168
(6): 656–64. <a href="https://doi.org/10.1093/aje/kwn164" class="external-link">https://doi.org/10.1093/aje/kwn164</a>.
</div>
<div id="ref-jacksonDiagnosticsConfoundingTimevarying2016" class="csl-entry">
Jackson, John W. 2016. <span>“Diagnostics for Confounding of
Time-Varying and Other Joint Exposures:”</span> <em>Epidemiology</em> 27
(6): 859–69. <a href="https://doi.org/10.1097/EDE.0000000000000547" class="external-link">https://doi.org/10.1097/EDE.0000000000000547</a>.
</div>
<div id="ref-robinsMarginalStructuralModels2000" class="csl-entry">
Robins, James M., Miguel Ángel Hernán, and Babette Brumback. 2000.
<span>“Marginal Structural Models and Causal Inference in
Epidemiology.”</span> <em>Epidemiology</em> 11 (5): 550–60. <a href="https://doi.org/10.1097/00001648-200009000-00011" class="external-link">https://doi.org/10.1097/00001648-200009000-00011</a>.
</div>
<div id="ref-thoemmesPrimerInverseProbability2016" class="csl-entry">
Thoemmes, Felix J., and Anthony D. Ong. 2016. <span>“A Primer on Inverse
Probability of Treatment Weighting and Marginal Structural
Models.”</span> <em>Emerging Adulthood</em> 4 (1): 40–59. <a href="https://doi.org/10.1177/2167696815621645" class="external-link">https://doi.org/10.1177/2167696815621645</a>.
</div>
<div id="ref-vanderweeleCausalInferenceLongitudinal2016" class="csl-entry">
VanderWeele, Tyler J., John W. Jackson, and Shanshan Li. 2016.
<span>“Causal Inference and Longitudinal Data: A Case Study of Religion
and Mental Health.”</span> <em>Social Psychiatry and Psychiatric
Epidemiology</em> 51 (11): 1457–66. <a href="https://doi.org/10.1007/s00127-016-1281-9" class="external-link">https://doi.org/10.1007/s00127-016-1281-9</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
