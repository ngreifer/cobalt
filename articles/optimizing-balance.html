<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Optimizing Tuning Parameters for Balance • cobalt</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimizing Tuning Parameters for Balance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cobalt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.5.5.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/cobalt.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/other-packages.html">Using `cobalt` with Other Preprocessing Packages</a></li>
    <li><a class="dropdown-item" href="../articles/segmented-data.html">Using `cobalt` with Clustered, Multiply Imputed, and Other Segmented Data</a></li>
    <li><a class="dropdown-item" href="../articles/longitudinal-treat.html">Using `cobalt` with Longitudinal Treatments</a></li>
    <li><a class="dropdown-item" href="../articles/love.plot.html">Using `love.plot()` To Generate Love Plots</a></li>
    <li><a class="dropdown-item" href="../articles/optimizing-balance.html">Optimizing Tuning Parameters for Balance</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/cobalt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Optimizing Tuning Parameters for Balance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/cobalt/blob/master/vignettes/optimizing-balance.Rmd" class="external-link"><code>vignettes/optimizing-balance.Rmd</code></a></small>
      <div class="d-none name"><code>optimizing-balance.Rmd</code></div>
    </div>

    
    
<p>Part of using balancing methods, including matching, weighting, and
subclassification, involves specifying a conditioning method, assessing
balance after applying that method, and repeating until satisfactory
balance is achieved. For example, in propensity score score
subclassification, one needs to decide on the number of subclasses to
use, and one way to do so is to try a number of of subclasses, assess
balance after subclassification, try another number of subclasses,
assess balance, and so on. As another example, in estimating the
propensity score model itself, one might decided which covariates to
include in the model (after deciding on a fixed set of covariates to
balance), which covariates should have squares or interactions, and
which link function (e.g., probit, logit) to use. Or choosing the number
of matches each unit should receive in k:1 matching, or which value of
the propensity score should be used to trim samples, etc.</p>
<p>Essentially, these problems all involve selecting a specification by
varying a number of parameters, which are sometimes called “tuning
parameters”, in order to optimize balance. Many popular methods adjust
tuning parameters to optimize balance as inherent parts of the method,
like genetic matching <span class="citation">(<a href="#ref-diamondGeneticMatchingEstimating2013">Diamond and Sekhon
2013</a>)</span>, which tunes variance importance in the distance
matrix, or generalized boosted modeling <span class="citation">(<a href="#ref-mccaffreyPropensityScoreEstimation2004">McCaffrey, Ridgeway,
and Morral 2004</a>)</span>, which tunes the number of trees in the
prediction model for propensity scores. This strategy tends to yield
methods that perform better than methods that don’t tune at all or tune
to optimize a criterion other than balance (e.g., prediction accuracy)
<span class="citation">Pirracchio and Carone (<a href="#ref-pirracchioBalanceSuperLearner2018">2018</a>)</span>.</p>
<p>As of version 4.5.0, <code>cobalt</code> provides the functions
<code><a href="../reference/bal.compute.html">bal.compute()</a></code> and <code><a href="../reference/bal.compute.html">bal.init()</a></code> to aid in
selecting these tuning parameters in an efficient way without needing to
manually program the computation of the balance statistic used as the
criterion to optimize. This vignette explains how to use these
functions, describes the balance statistics that are available, and
provides examples of using these functions to implement new and existing
balancing methods yourself. These functions are primarily for use inside
other packages but may be useful to users experimenting with new
methods. For a complete way to assess balance for a single
specification, users should use <code><a href="../reference/bal.tab.html">bal.tab()</a></code> and
<code><a href="../reference/bal.plot.html">bal.plot()</a></code> instead.</p>
<div class="section level2">
<h2 id="bal-compute-and-bal-init">
<code>bal.compute()</code> and <code>bal.init()</code><a class="anchor" aria-label="anchor" href="#bal-compute-and-bal-init"></a>
</h2>
<p>Broadly, these functions work by taking in the treatment, covariates
for which balance is to be computed, and a set of balancing weights and
return a scalar balance statistic that summarizes balance for the
sample. <code><a href="../reference/bal.compute.html">bal.compute()</a></code> does the work of computing the
balance statistic, and <code><a href="../reference/bal.compute.html">bal.init()</a></code> processes the inputs so
they don’t need to be processed every time <code><a href="../reference/bal.compute.html">bal.compute()</a></code> is
called with a new set of weights.</p>
<p>For <code><a href="../reference/bal.compute.html">bal.init()</a></code>, we need to supply the covariates, the
treatment, the name of the balance statistic we wish to compute,
sampling weights (if any), and any other inputs required, which depend
on the specific balance statistic requested. <code><a href="../reference/bal.compute.html">bal.init()</a></code>
returns a <code>bal.init</code> object, which is then passed to
<code><a href="../reference/bal.compute.html">bal.compute()</a></code> along with a set of balancing weights (which
may result from weighting, matching, or subclassification).</p>
<p>Below, we provide an example using the <code>lalonde</code> dataset.
Our balance statistic will be the largest absolute standardized mean
difference among the included covariates, which is specified as
<code>"smd.max"</code>. We will first supply the required inputs to
<code><a href="../reference/bal.compute.html">bal.init()</a></code> and pass its output to
<code><a href="../reference/bal.compute.html">bal.compute()</a></code> to compute the balance statistic for the
sample prior to weighting.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/cobalt/">cobalt</a></span><span class="op">)</span></span>
<span><span class="co">#&gt;  cobalt (Version 4.5.5.9001, Build Date: 2025-04-07)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">race</span>, <span class="va">re78</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the object with the balance statistic,</span></span>
<span><span class="co"># treatment, and covariates</span></span>
<span><span class="va">smd.init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bal.compute.html">bal.init</a></span><span class="op">(</span><span class="va">covs</span>,</span>
<span>                     treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>                     stat <span class="op">=</span> <span class="st">"smd.max"</span>,</span>
<span>                     estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute balance with no weights</span></span>
<span><span class="fu"><a href="../reference/bal.compute.html">bal.compute</a></span><span class="op">(</span><span class="va">smd.init</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8263093</span></span>
<span></span>
<span><span class="co"># Can also compute the statistic directly using bal.compute():</span></span>
<span><span class="fu"><a href="../reference/bal.compute.html">bal.compute</a></span><span class="op">(</span><span class="va">covs</span>,</span>
<span>            treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>            stat <span class="op">=</span> <span class="st">"smd.max"</span>,</span>
<span>            estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8263093</span></span></code></pre></div>
<p>The largest absolute standardized mean difference with no weights is
0.8263, which we can verify and investigate further using
<code><a href="../reference/bal.tab.html">bal.tab()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">covs</span>,</span>
<span>        treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>        binary <span class="op">=</span> <span class="st">"std"</span>,</span>
<span>        estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>        thresholds <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">#&gt;             Type Diff.Un      M.Threshold.Un</span></span>
<span><span class="co">#&gt; age      Contin. -0.3094 Not Balanced, &gt;0.05</span></span>
<span><span class="co">#&gt; educ     Contin.  0.0550 Not Balanced, &gt;0.05</span></span>
<span><span class="co">#&gt; married   Binary -0.8263 Not Balanced, &gt;0.05</span></span>
<span><span class="co">#&gt; nodegree  Binary  0.2450 Not Balanced, &gt;0.05</span></span>
<span><span class="co">#&gt; re74     Contin. -0.7211 Not Balanced, &gt;0.05</span></span>
<span><span class="co">#&gt; re75     Contin. -0.2903 Not Balanced, &gt;0.05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Balance tally for mean differences</span></span></span>
<span><span class="co">#&gt;                     count</span></span>
<span><span class="co">#&gt; Balanced, &lt;0.05         0</span></span>
<span><span class="co">#&gt; Not Balanced, &gt;0.05     6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Variable with the greatest mean difference</span></span></span>
<span><span class="co">#&gt;  Variable Diff.Un      M.Threshold.Un</span></span>
<span><span class="co">#&gt;   married -0.8263 Not Balanced, &gt;0.05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">#&gt;     Control Treated</span></span>
<span><span class="co">#&gt; All     429     185</span></span></code></pre></div>
<p>We can see that the largest value corresponds to the covariate
<code>married</code>.</p>
<p>Now, lets estimate weights using probit regression propensity scores
in <code>WeightIt</code> and see whether this balance statistic
decreases after applying the weights:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/WeightIt/" class="external-link">"WeightIt"</a></span><span class="op">)</span></span>
<span><span class="va">w.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span></span>
<span>                      <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"glm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                  link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the balance statistic on the estimated weights</span></span>
<span><span class="fu"><a href="../reference/bal.compute.html">bal.compute</a></span><span class="op">(</span><span class="va">smd.init</span>, <span class="fu"><a href="../reference/get.w.html">get.w</a></span><span class="op">(</span><span class="va">w.out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.06936946</span></span></code></pre></div>
<p>After weighting, our balance statistic is 0.0694, indicating a
significant improvement. Let’s try again with logistic regression:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span></span>
<span>                      <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"glm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                  link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the balance statistic on the estimated weights</span></span>
<span><span class="fu"><a href="../reference/bal.compute.html">bal.compute</a></span><span class="op">(</span><span class="va">smd.init</span>, <span class="fu"><a href="../reference/get.w.html">get.w</a></span><span class="op">(</span><span class="va">w.out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.04791925</span></span></code></pre></div>
<p>This is better, but we can do even better with bias-reduced logistic
regression <span class="citation">(<a href="#ref-kosmidis2020">Kosmidis
and Firth 2020</a>)</span>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span></span>
<span>                      <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"glm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                  link <span class="op">=</span> <span class="st">"br.logit"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the balance statistic on the estimated weights</span></span>
<span><span class="fu"><a href="../reference/bal.compute.html">bal.compute</a></span><span class="op">(</span><span class="va">smd.init</span>, <span class="fu"><a href="../reference/get.w.html">get.w</a></span><span class="op">(</span><span class="va">w.out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.04392724</span></span></code></pre></div>
<p>Instead of writing each complete call one at a time, we can do a
little programming to make this happen automatically:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize object to compute the largest SMD</span></span>
<span><span class="va">smd.init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bal.compute.html">bal.init</a></span><span class="op">(</span><span class="va">covs</span>,</span>
<span>                     treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>                     stat <span class="op">=</span> <span class="st">"smd.max"</span>,</span>
<span>                     estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create vector of tuning parameters</span></span>
<span><span class="va">links</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"probit"</span>, <span class="st">"logit"</span>, <span class="st">"cloglog"</span>,</span>
<span>           <span class="st">"br.probit"</span>, <span class="st">"br.logit"</span>, <span class="st">"br.cloglog"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply each link to estimate weights</span></span>
<span><span class="co"># Can replace sapply() with purrr::map()</span></span>
<span><span class="va">weights.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">links</span>, <span class="kw">function</span><span class="op">(</span><span class="va">link</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">w.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span></span>
<span>                      <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">"glm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                  link <span class="op">=</span> <span class="va">link</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/get.w.html">get.w</a></span><span class="op">(</span><span class="va">w.out</span><span class="op">)</span></span>
<span><span class="op">}</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use each set of weights to compute balance</span></span>
<span><span class="co"># Can replace sapply() with purrr:map_vec()</span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">weights.list</span>, <span class="va">bal.compute</span>,</span>
<span>                x <span class="op">=</span> <span class="va">smd.init</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See which set of weights is the best</span></span>
<span><span class="va">stats</span></span>
<span><span class="co">#&gt;     probit      logit    cloglog  br.probit   br.logit br.cloglog </span></span>
<span><span class="co">#&gt; 0.06936946 0.04791925 0.02726102 0.06444577 0.04392724 0.02457557</span></span>
<span><span class="va">stats</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; br.cloglog </span></span>
<span><span class="co">#&gt; 0.02457557</span></span></code></pre></div>
<p>Interestingly, bias-reduced complimentary log-log regression produced
weights with the smallest maximum absolute standardized mean difference.
We can use <code><a href="../reference/bal.tab.html">bal.tab()</a></code> to more finely examine balance on the
chosen weights:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">covs</span>,</span>
<span>        treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>        binary <span class="op">=</span> <span class="st">"std"</span>,</span>
<span>        weights <span class="op">=</span> <span class="va">weights.list</span><span class="op">[[</span><span class="st">"br.cloglog"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">#&gt;             Type Diff.Adj</span></span>
<span><span class="co">#&gt; age      Contin.  -0.0089</span></span>
<span><span class="co">#&gt; educ     Contin.  -0.0246</span></span>
<span><span class="co">#&gt; married   Binary  -0.0012</span></span>
<span><span class="co">#&gt; nodegree  Binary   0.0145</span></span>
<span><span class="co">#&gt; re74     Contin.  -0.0209</span></span>
<span><span class="co">#&gt; re75     Contin.  -0.0213</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">#&gt;            Control Treated</span></span>
<span><span class="co">#&gt; Unadjusted  429.       185</span></span>
<span><span class="co">#&gt; Adjusted    240.83     185</span></span></code></pre></div>
<p>If balance is acceptable, you would move forward with these weights
in estimating the treatment effect. Otherwise, you might try other
values of the tuning parameters, other specifications of the model, or
other weighting methods to try to achieve excellent balance.</p>
</div>
<div class="section level2">
<h2 id="balance-statistics">Balance statistics<a class="anchor" aria-label="anchor" href="#balance-statistics"></a>
</h2>
<p>Several balance statistics can be computed by
<code><a href="../reference/bal.compute.html">bal.compute()</a></code> and <code><a href="../reference/bal.compute.html">bal.init()</a></code>, and the ones
available depend on whether the treatment is binary, multi-category, or
continuous. These are explained below and on the help page
<code><a href="../reference/bal.compute.html">?bal.compute</a></code>. A complete list for a given treatment type
can be requested using <code><a href="../reference/bal.compute.html">available.stats()</a></code>. Some balance
statistics are appended with <code>".mean"</code>, <code>".max"</code>,
or <code>".rms"</code>, which correspond to the mean (or L1-norm),
maximum (or L-infinity norm), and root mean square (or L2-norm) of the
absolute univariate balance statistic computed for each covariate.</p>
<div class="section level4">
<h4 id="smd-mean-smd-max-smd-rms">
<code>smd.mean</code>, <code>smd.max</code>,
<code>smd.rms</code><a class="anchor" aria-label="anchor" href="#smd-mean-smd-max-smd-rms"></a>
</h4>
<p>The mean, maximum, and root mean square of the absolute standardized
mean differences computed for the covariates using
<code><a href="../reference/balance-summary.html">col_w_smd()</a></code>. The other allowable arguments include
<code>estimand</code> (ATE, ATC, or ATT) to select the estimand,
<code>focal</code> to identify the focal treatment group when the ATT is
the estimand and the treatment has more than two categories, and
<code>pairwise</code> to select whether mean differences should be
computed between each pair of treatment groups or between each treatment
group and the target group identified by <code>estimand</code> (default
<code>TRUE</code>). Can be used with binary and multi-category
treatments.</p>
</div>
<div class="section level4">
<h4 id="ks-mean-ks-max-ks-rms">
<code>ks.mean</code>, <code>ks.max</code>, <code>ks.rms</code><a class="anchor" aria-label="anchor" href="#ks-mean-ks-max-ks-rms"></a>
</h4>
<p>The mean, maximum, or root-mean-squared Kolmogorov-Smirnov statistic,
computed using <code><a href="../reference/balance-summary.html">col_w_ks()</a></code>. The other allowable arguments
include <code>estimand</code> (ATE, ATC, or ATT) to select the estimand,
<code>focal</code> to identify the focal treatment group when the ATT is
the estimand and the treatment has more than two categories, and
<code>pairwise</code> to select whether statistics should be computed
between each pair of treatment groups or between each treatment group
and the target group identified by <code>estimand</code> (default
<code>TRUE</code>). Can be used with binary and multi-category
treatments.</p>
</div>
<div class="section level4">
<h4 id="ovl-mean-ovl-max-ovl-rms">
<code>ovl.mean</code>, <code>ovl.max</code>,
<code>ovl.rms</code><a class="anchor" aria-label="anchor" href="#ovl-mean-ovl-max-ovl-rms"></a>
</h4>
<p>The mean, maximum, or root-mean-squared overlapping coefficient
compliment, computed using <code><a href="../reference/balance-summary.html">col_w_ovl()</a></code>. The other allowable
arguments include <code>estimand</code> (ATE, ATC, or ATT) to select the
estimand, <code>focal</code> to identify the focal treatment group when
the ATT is the estimand and the treatment has more than two categories,
and <code>pairwise</code> to select whether statistics should be
computed between each pair of treatment groups or between each treatment
group and the target group identified by <code>estimand</code> (default
<code>TRUE</code>). Can be used with binary and multi-category
treatments.</p>
</div>
<div class="section level4">
<h4 id="mahalanobis">
<code>mahalanobis</code><a class="anchor" aria-label="anchor" href="#mahalanobis"></a>
</h4>
<p>The Mahalanobis distance between the treatment group means, which is
computed as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>𝐱</mi><mo accent="true">‾</mo></mover><mn>1</mn></msub><mo>−</mo><msub><mover><mi>𝐱</mi><mo accent="true">‾</mo></mover><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>𝐱</mi><mo accent="true">‾</mo></mover><mn>1</mn></msub><mo>−</mo><msub><mover><mi>𝐱</mi><mo accent="true">‾</mo></mover><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt><annotation encoding="application/x-tex">
\sqrt{(\mathbf{\bar{x}}_1 - \mathbf{\bar{x}}_0) \Sigma^{-1} (\mathbf{\bar{x}}_1 - \mathbf{\bar{x}}_0)}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>𝐱</mi><mo accent="true">‾</mo></mover><mn>1</mn></msub><annotation encoding="application/x-tex">\mathbf{\bar{x}}_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>𝐱</mi><mo accent="true">‾</mo></mover><mn>0</mn></msub><annotation encoding="application/x-tex">\mathbf{\bar{x}}_0</annotation></semantics></math>
are the vectors of covariate means in the two treatment groups,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Σ</mi><mo>−</mo></msup><mn>1</mn></mrow><annotation encoding="application/x-tex">\Sigma^-1</annotation></semantics></math>
is the (generalized) inverse of the covariance matrix of the covariates
<span class="citation">(<a href="#ref-franklinMetricsCovariateBalance2014">Franklin et al.
2014</a>)</span>. This is similar to <code>"smd.rms"</code> but the
covariates are standardized to remove correlations between and
de-emphasize redundant covariates. The other allowable arguments include
<code>estimand</code> (ATE, ATC, or ATT) to select the estimand, which
determines how the covariance matrix is calculated, and
<code>focal</code> to identify the focal treatment group when the ATT is
the estimand. Can only be used with binary treatments.</p>
</div>
<div class="section level4">
<h4 id="energy-dist">
<code>energy.dist</code><a class="anchor" aria-label="anchor" href="#energy-dist"></a>
</h4>
<p>The total energy distance between each treatment group and the target
sample, which is a scalar measure of the similarity between two
multivariate distributions. See <span class="citation">Huling and Mak
(<a href="#ref-hulingEnergyBalancingCovariate2022">2022</a>)</span> for
details. The other allowable arguments include <code>estimand</code>
(ATE, ATC, or ATT) to select the estimand, <code>focal</code> to
identify the focal treatment group when the ATT is the estimand and the
treatment has more than two categories, and <code>improved</code> to
select whether the “improved” energy distance should be used, which
emphasizes difference between treatment groups in addition to difference
between each treatment group and the target sample (default
<code>TRUE</code>). Can be used with binary and multi-category
treatments.</p>
</div>
<div class="section level4">
<h4 id="kernel-dist">
<code>kernel.dist</code><a class="anchor" aria-label="anchor" href="#kernel-dist"></a>
</h4>
<p>The kernel distance between treatment groups, which is a scalar
measure of the similarity between two multivariate distributions. See
<span class="citation">Zhu, Savage, and Ghosh (<a href="#ref-zhuKernelBasedMetricBalance2018">2018</a>)</span> for
details. Can only be used with binary treatments.</p>
</div>
<div class="section level4">
<h4 id="l1-med">
<code>l1.med</code><a class="anchor" aria-label="anchor" href="#l1-med"></a>
</h4>
<p>The median L1 statistic computed across a random selection of
possible coarsening of the data. See <span class="citation">Iacus, King,
and Porro (<a href="#ref-iacusMultivariateMatchingMethods2011">2011</a>)</span> for
details. The other allowable arguments include <code>l1.min.bin</code>
(default 2) and <code>l1.max.bin</code> default (12) to select the
minimum and maximum number of bins with which to bin continuous
variables and <code>l1.n</code> (default 101) to select the number of
binnings used to select the binning at the median. <code>covs</code>
should be supplied without splitting factors into dummies to ensure the
binning works correctly. Can be used with binary and multi-category
treatments.</p>
</div>
<div class="section level4">
<h4 id="r2-r2-2-r2-3">
<code>r2</code>, <code>r2.2</code>, <code>r2.3</code><a class="anchor" aria-label="anchor" href="#r2-r2-2-r2-3"></a>
</h4>
<p>The post-weighting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
of a model for the treatment given the covariates. <span class="citation">Franklin et al. (<a href="#ref-franklinMetricsCovariateBalance2014">2014</a>)</span>
describe a similar but less generalizable metric, the “post-matching
c-statistic”. The other allowable arguments include <code>poly</code> to
add polynomial terms of the supplied order to the model and
<code>int</code> (default <code>FALSE</code>) to add two-way
interactions between covariates into the model. Using
<code>"r2.2"</code> is a shortcut to requesting squares, and using
<code>"r2.3"</code> is a shortcut to requesting cubes. Can be used with
binary and continuous treatments. For binary treatments, the McKelvey
and Zavoina
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
from a logistic regression is used; for continuous treatments, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>R</mi><mn>2</mn></msup><annotation encoding="application/x-tex">R^2</annotation></semantics></math>
from a linear regression is used.</p>
</div>
<div class="section level4">
<h4 id="p-mean-p-max-p-rms">
<code>p.mean</code>, <code>p.max</code>, <code>p.rms</code><a class="anchor" aria-label="anchor" href="#p-mean-p-max-p-rms"></a>
</h4>
<p>The mean, maximum, or root-mean-squared absolute Pearson correlation
between the treatment and covariates, computed using
<code><a href="../reference/balance-summary.html">col_w_corr()</a></code>. Can only be used with continuous
treatments.</p>
</div>
<div class="section level4">
<h4 id="s-mean-s-max-s-rms">
<code>s.mean</code>, <code>s.max</code>, <code>s.rms</code><a class="anchor" aria-label="anchor" href="#s-mean-s-max-s-rms"></a>
</h4>
<p>The mean, maximum, or root-mean-squared absolute Spearman correlation
between the treatment and covariates, computed using
<code><a href="../reference/balance-summary.html">col_w_corr()</a></code>. Can only be used with continuous
treatments.</p>
</div>
<div class="section level4">
<h4 id="distance-cov">
<code>distance.cov</code><a class="anchor" aria-label="anchor" href="#distance-cov"></a>
</h4>
<p>The distance covariance between the scaled covariates and treatment,
which is a scalar measure of the independence of two possibly
multivariate distributions. See <span class="citation">Huling, Greifer,
and Chen (<a href="#ref-hulingIndependenceWeightsCausal2023a">2023</a>)</span> for
details. Can only be used with continuous treatments.</p>
</div>
<div class="section level3">
<h3 id="choosing-a-balance-statistic">Choosing a balance statistic<a class="anchor" aria-label="anchor" href="#choosing-a-balance-statistic"></a>
</h3>
<p>Given all these options, how should one choose? There has been some
research into which yields the best results <span class="citation">(<a href="#ref-franklinMetricsCovariateBalance2014">Franklin et al.
2014</a>; <a href="#ref-griffinChasingBalanceOther2017">Griffin et al.
2017</a>; <a href="#ref-stuartPrognosticScorebasedBalance2013">Stuart,
Lee, and Leacy 2013</a>; <a href="#ref-belitserMeasuringBalanceModel2011">Belitser et al. 2011</a>;
<a href="#ref-parastOptimizingVariancebiasTradeoff2017">Parast et al.
2017</a>)</span>, but the actual performance of each depends on the
unique features of the data and system under study. For example, in the
unlikely case that the true outcome model is linear in the covariates,
using the <code>"smd"</code> or <code>"mahalanobis"</code> statistics
will work well for binary and multi-category treatments. In more
realistic cases, though, every measure has its advantages and
disadvantages.</p>
<p>For binary and multi-category treatments, only
<code>"energy.dist"</code>, <code>"kernel.dist"</code>, and
<code>"L1.med"</code> reflect balance on all features of the joint
covariate distribution, whereas the others summarize across balance
statistics computed for each covariate ignoring the others. Similarly,
for continuous treatments, only <code>"distance.cov"</code> reflects
balance on all features of the joint covariate distribution. Given these
advantages, <code>"energy.dist"</code> and <code>"distance.cov"</code>
are my preferences. That said, other measures are better studied,
possibly more intuitive, and more familiar to a broad audience.</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>In this section, I will provide an example that demonstrates how
these functions could be used to replicate the functionality of existing
packages or develop new methods for optimizing balance. We will use
these functions to replicate the functionality of <code>WeightIt</code>
and <code>twang</code> for estimating propensity score weights for a
binary treatment using generalized boosted modeling (GBM). See
<code><a href="../reference/bal.compute.html">help("bal.compute")</a></code> for another example that optimizes
balance to find the number of subclasses in propensity score
subclassification.</p>
<div class="section level3">
<h3 id="tuning-gbm-for-balance">Tuning GBM for balance<a class="anchor" aria-label="anchor" href="#tuning-gbm-for-balance"></a>
</h3>
<p>GBM has many tuning parameters that can be optimized, but the key
parameter is the number of trees to use to calculate the predictions.
<code>WeightIt</code> and <code>twang</code> both implement the methods
described in <span class="citation">McCaffrey, Ridgeway, and Morral (<a href="#ref-mccaffreyPropensityScoreEstimation2004">2004</a>)</span> for
selecting the number of trees using a balance criterion. Here, we will
do so manually both to understand the internals of these functions and
illustrate the uses of <code><a href="../reference/bal.compute.html">bal.compute()</a></code> and
<code><a href="../reference/bal.compute.html">bal.init()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize balance</span></span>
<span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">re78</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ks.init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bal.compute.html">bal.init</a></span><span class="op">(</span><span class="va">covs</span>,</span>
<span>                    treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>                    stat <span class="op">=</span> <span class="st">"ks.max"</span>,</span>
<span>                    estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit a GBM model using `WeightIt` and `twang` defaults</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">gbm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span></span>
<span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                distribution <span class="op">=</span> <span class="st">"bernoulli"</span>,</span>
<span>                n.trees <span class="op">=</span> <span class="fl">4000</span>, interaction.depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                shrinkage <span class="op">=</span> <span class="fl">.01</span>, bag.fraction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trees_to_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>                 n.trees <span class="op">=</span> <span class="va">trees_to_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">p.mat</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Compute ATT weights</span></span>
<span>    <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">p</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="../reference/bal.compute.html">bal.compute</a></span><span class="op">(</span><span class="va">ks.init</span>, weights <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stats</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;       1408 </span></span>
<span><span class="co">#&gt; 0.09563649</span></span></code></pre></div>
<p>From these results, we see that using 1408 trees gives us the lowest
maximum KS statistic of 0.0956. Out of interest, we can plot the
relationship between the number of trees and our balance statistic to
see what it looks like:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">trees_to_test</span>, y <span class="op">=</span> <span class="va">stats</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"ks.max"</span>, x <span class="op">=</span> <span class="st">"n.trees"</span><span class="op">)</span></span></code></pre></div>
<p><img src="optimizing-balance_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Let’s compare this to the output of <code>WeightIt</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/WeightIt/" class="external-link">"WeightIt"</a></span><span class="op">)</span></span>
<span><span class="va">w.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span></span>
<span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                data <span class="op">=</span> <span class="va">lalonde</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"gbm"</span>, n.trees <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>                stop.method <span class="op">=</span> <span class="st">"ks.max"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the best tree:</span></span>
<span><span class="va">w.out</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">best.tree</span></span>
<span><span class="co">#&gt;   1 </span></span>
<span><span class="co">#&gt; 735</span></span>
<span></span>
<span><span class="co"># ks.max from weightit()</span></span>
<span><span class="fu"><a href="../reference/bal.compute.html">bal.compute</a></span><span class="op">(</span><span class="va">ks.init</span>, weights <span class="op">=</span> <span class="fu"><a href="../reference/get.w.html">get.w</a></span><span class="op">(</span><span class="va">w.out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.08745454</span></span></code></pre></div>
<p>We can see that <code><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit()</a></code> also selects 735 trees as the
optimum and the resulting maximum KS statistic computed using the
returned weights is equal to the one we computed manually. Using
<code>twang</code> also produces the same results.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-belitserMeasuringBalanceModel2011" class="csl-entry">
Belitser, Svetlana V., Edwin P. Martens, Wiebe R. Pestman, Rolf H. H.
Groenwold, Anthonius de Boer, and Olaf H. Klungel. 2011.
<span>“Measuring Balance and Model Selection in Propensity Score
Methods.”</span> <em>Pharmacoepidemiology and Drug Safety</em> 20 (11):
1115–29. <a href="https://doi.org/10.1002/pds.2188" class="external-link">https://doi.org/10.1002/pds.2188</a>.
</div>
<div id="ref-diamondGeneticMatchingEstimating2013" class="csl-entry">
Diamond, Alexis, and Jasjeet S. Sekhon. 2013. <span>“Genetic Matching
for Estimating Causal Effects: A General Multivariate Matching Method
for Achieving Balance in Observational Studies.”</span> <em>Review of
Economics and Statistics</em> 95 (3): 932945. <a href="https://doi.org/10.1162/REST_a_00318" class="external-link">https://doi.org/10.1162/REST_a_00318</a>.
</div>
<div id="ref-franklinMetricsCovariateBalance2014" class="csl-entry">
Franklin, Jessica M., Jeremy A. Rassen, Diana Ackermann, Dorothee B.
Bartels, and Sebastian Schneeweiss. 2014. <span>“Metrics for Covariate
Balance in Cohort Studies of Causal Effects.”</span> <em>Statistics in
Medicine</em> 33 (10): 1685–99. <a href="https://doi.org/10.1002/sim.6058" class="external-link">https://doi.org/10.1002/sim.6058</a>.
</div>
<div id="ref-griffinChasingBalanceOther2017" class="csl-entry">
Griffin, Beth Ann, Daniel F. McCaffrey, Daniel Almirall, Lane F.
Burgette, and Claude Messan Setodji. 2017. <span>“Chasing Balance and
Other Recommendations for Improving Nonparametric Propensity Score
Models.”</span> <em>Journal of Causal Inference</em> 5 (2). <a href="https://doi.org/10.1515/jci-2015-0026" class="external-link">https://doi.org/10.1515/jci-2015-0026</a>.
</div>
<div id="ref-hulingIndependenceWeightsCausal2023a" class="csl-entry">
Huling, Jared D., Noah Greifer, and Guanhua Chen. 2023.
<span>“Independence Weights for Causal Inference with Continuous
Treatments.”</span> <em>Journal of the American Statistical
Association</em> 0 (0): 1–14. <a href="https://doi.org/10.1080/01621459.2023.2213485" class="external-link">https://doi.org/10.1080/01621459.2023.2213485</a>.
</div>
<div id="ref-hulingEnergyBalancingCovariate2022" class="csl-entry">
Huling, Jared D., and Simon Mak. 2022. <span>“Energy Balancing of
Covariate Distributions.”</span> <a href="https://doi.org/10.48550/arXiv.2004.13962" class="external-link">https://doi.org/10.48550/arXiv.2004.13962</a>.
</div>
<div id="ref-iacusMultivariateMatchingMethods2011" class="csl-entry">
Iacus, Stefano M., Gary King, and Giuseppe Porro. 2011.
<span>“Multivariate Matching Methods That Are Monotonic Imbalance
Bounding.”</span> <em>Journal of the American Statistical
Association</em> 106 (493): 345–61. <a href="https://doi.org/10.1198/jasa.2011.tm09599" class="external-link">https://doi.org/10.1198/jasa.2011.tm09599</a>.
</div>
<div id="ref-kosmidis2020" class="csl-entry">
Kosmidis, Ioannis, and David Firth. 2020. <span>“Jeffreys-Prior Penalty,
Finiteness and Shrinkage in Binomial-Response Generalized Linear
Models.”</span> <em>Biometrika</em> 108 (1): 71–82. <a href="https://doi.org/10.1093/biomet/asaa052" class="external-link">https://doi.org/10.1093/biomet/asaa052</a>.
</div>
<div id="ref-mccaffreyPropensityScoreEstimation2004" class="csl-entry">
McCaffrey, Daniel F., Greg Ridgeway, and Andrew R. Morral. 2004.
<span>“Propensity Score Estimation With Boosted Regression for
Evaluating Causal Effects in Observational Studies.”</span>
<em>Psychological Methods</em> 9 (4): 403–25. <a href="https://doi.org/10.1037/1082-989X.9.4.403" class="external-link">https://doi.org/10.1037/1082-989X.9.4.403</a>.
</div>
<div id="ref-parastOptimizingVariancebiasTradeoff2017" class="csl-entry">
Parast, Layla, Daniel F. McCaffrey, Lane F. Burgette, Fernando Hoces de
la Guardia, Daniela Golinelli, Jeremy N. V. Miles, and Beth Ann Griffin.
2017. <span>“Optimizing Variance-Bias Trade-Off in the TWANG Package for
Estimation of Propensity Scores.”</span> <em>Health Services and
Outcomes Research Methodology</em> 17 (3): 175–97. <a href="https://doi.org/10.1007/s10742-016-0168-2" class="external-link">https://doi.org/10.1007/s10742-016-0168-2</a>.
</div>
<div id="ref-pirracchioBalanceSuperLearner2018" class="csl-entry">
Pirracchio, Romain, and Marco Carone. 2018. <span>“The Balance Super
Learner: A Robust Adaptation of the <span><em>Super Learner</em></span>
to Improve Estimation of the Average Treatment Effect in the Treated
Based on Propensity Score Matching.”</span> <em>Statistical Methods in
Medical Research</em> 27 (8): 2504–18. <a href="https://doi.org/10.1177/0962280216682055" class="external-link">https://doi.org/10.1177/0962280216682055</a>.
</div>
<div id="ref-stuartPrognosticScorebasedBalance2013" class="csl-entry">
Stuart, Elizabeth A., Brian K. Lee, and Finbarr P. Leacy. 2013.
<span>“Prognostic Score-Based Balance Measures Can Be a Useful
Diagnostic for Propensity Score Methods in Comparative Effectiveness
Research.”</span> <em>Journal of Clinical Epidemiology</em> 66 (8): S84.
<a href="https://doi.org/10.1016/j.jclinepi.2013.01.013" class="external-link">https://doi.org/10.1016/j.jclinepi.2013.01.013</a>.
</div>
<div id="ref-zhuKernelBasedMetricBalance2018" class="csl-entry">
Zhu, Yeying, Jennifer S. Savage, and Debashis Ghosh. 2018. <span>“A
Kernel-Based Metric for Balance Assessment.”</span> <em>Journal of
Causal Inference</em> 6 (2). <a href="https://doi.org/10.1515/jci-2016-0029" class="external-link">https://doi.org/10.1515/jci-2016-0029</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
