<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Appendix 3: Using cobalt with Longitudinal Treatments • cobalt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Appendix 3: Using cobalt with Longitudinal Treatments">
<meta property="og:description" content="cobalt">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cobalt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cobalt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cobalt_A1_other_packages.html">Appendix 1: Using cobalt with Other Preprocessing Packages</a>
    </li>
    <li>
      <a href="../articles/cobalt_A2_segmented_data.html">Appendix 2: Using cobalt with Clustered, Multiply Imputed, and Other Segmented Data</a>
    </li>
    <li>
      <a href="../articles/cobalt_A3_longitudinal_treat.html">Appendix 3: Using cobalt with Longitudinal Treatments</a>
    </li>
    <li>
      <a href="../articles/cobalt_A4_love.plot.html">Appendix 4: Using love.plot To Generate Love Plots</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ngreifer/cobalt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cobalt_A3_longitudinal_treat_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Appendix 3: Using cobalt with Longitudinal Treatments</h1>
                        <h4 data-toc-skip class="author">Noah Greifer</h4>
            
            <h4 data-toc-skip class="date">2022-08-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/cobalt/blob/HEAD/vignettes/cobalt_A3_longitudinal_treat.Rmd" class="external-link"><code>vignettes/cobalt_A3_longitudinal_treat.Rmd</code></a></small>
      <div class="hidden name"><code>cobalt_A3_longitudinal_treat.Rmd</code></div>

    </div>

    
    
<p>This is an introduction to the use of <code>cobalt</code> with longitudinal treatments. These occur when there are multiple treatment periods spaced over time, with the potential for time-dependent confounding to occur. A common way to estimate treatment effects in these scenarios is to use marginal structural models (MSM), weighted by balancing weights. The goal of applying weights is to simulate a sequential randomization design, where the probability of being assigned to treatment at each time point is independent of each unit’s prior covariate and treatment history. For introduction to MSMs in general, see <span class="citation">Thoemmes and Ong (2016)</span>, <span class="citation">VanderWeele, Jackson, and Li (2016)</span>, <span class="citation">Cole and Hernán (2008)</span>, or <span class="citation">Robins, Hernán, and Brumback (2000)</span>. The key issue addressed by this guide and <code>cobalt</code> in general is assessing balance before each treatment period to ensure the removal of confounding.</p>
<p>In preprocessing for MSMs, three types of variables are relevant: baseline covariates, treatments, and intermediate outcomes/time-varying covariates. The goal of balance assessment is to assess whether after preprocessing, the resulting sample is one in which each treatment is independent of baseline covariates, treatment history, and time-varying covariates. The tools in <code>cobalt</code> have been developed to satisfy these goals.</p>
<p>The next section describe how to use <code>cobalt</code>’s tools to assess balance with longitudinal treatments. First, we’ll examine an example data set and identify some tools that can be used to generate weights for MSMs. Next we’ll use <code><a href="../reference/bal.tab.html">bal.tab()</a></code>, <code><a href="../reference/bal.plot.html">bal.plot()</a></code>, and <code><a href="../reference/love.plot.html">love.plot()</a></code> to assess and present balance.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We’re going to use the <code>iptwExWide</code> data set in the <code>twang</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/cobalt/" class="external-link">"cobalt"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"iptwExWide"</span>, package <span class="op">=</span> <span class="st">"twang"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iptwExWide</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      outcome gender age        use0         use1       use2 tx1 tx2 tx3</span></span>
<span><span class="co">## 1 -0.2782802      0  43  1.13496509  0.467482544  0.3174825   1   1   1</span></span>
<span><span class="co">## 2  0.5319329      0  50  1.11193185  0.455965923  0.4059659   1   0   1</span></span>
<span><span class="co">## 3 -0.8173614      1  36 -0.87077763 -0.535388817 -0.5853888   1   0   0</span></span>
<span><span class="co">## 4 -0.1530853      1  63  0.21073159  0.005365793 -0.1446342   1   1   1</span></span>
<span><span class="co">## 5 -0.7344267      0  24  0.06939565 -0.065302176 -0.1153022   1   0   1</span></span>
<span><span class="co">## 6 -0.8519376      1  20 -1.66264885 -0.931324426 -1.0813244   1   1   1</span></span></code></pre>
<p>We have the variables <code>outcome</code>, which is the outcome, <code>gender</code>, <code>age</code>, and <code>use0</code>, which are the baseline covariates, <code>use1</code> and <code>use2</code>, which are time-varying covariates measured after treatment periods 1 and 2, and <code>tx1</code>, <code>tx2</code>, and <code>tx3</code>, which are the treatments at each of the three treatment periods.</p>
<p>The goal of balance assessment in this scenario is to ensure the following:</p>
<ol style="list-style-type: decimal">
<li>
<code>tx1</code> is independent from <code>gender</code>, <code>age</code>, and <code>use0</code>
</li>
<li>
<code>tx2</code> is independent from <code>gender</code>, <code>age</code>, <code>use0</code>, <code>tx1</code>, and <code>use1</code>
</li>
<li>
<code>tx3</code> is independent from <code>gender</code>, <code>age</code>, <code>use0</code>, <code>tx1</code>, <code>use1</code>, <code>tx2</code>, and <code>use2</code>
</li>
</ol>
<p>To estimate the weights, we’ll use <code>WeightIt</code> to fit a series of logistic regressions that generate the weights. See the <code>WeightIt</code> documentation for more information on how to use <code>WeightIt</code> with longitudinal treatments.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Wmsm</span> <span class="op">&lt;-</span> <span class="fu">WeightIt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightitMSM.html" class="external-link">weightitMSM</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">tx1</span> <span class="op">~</span> <span class="va">use0</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>         <span class="va">tx2</span> <span class="op">~</span> <span class="va">use0</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">use1</span> <span class="op">+</span> <span class="va">tx1</span>,</span>
<span>         <span class="va">tx3</span> <span class="op">~</span> <span class="va">use0</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">use1</span> <span class="op">+</span> <span class="va">tx1</span> <span class="op">+</span> <span class="va">use2</span> <span class="op">+</span> <span class="va">tx2</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">iptwExWide</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"ps"</span><span class="op">)</span></span></code></pre></div>
<p>Next we’ll use <code><a href="../reference/bal.tab.html">bal.tab()</a></code> to examine balance before and after applying the weights.</p>
</div>
<div class="section level2">
<h2 id="bal-tab">
<code>bal.tab()</code><a class="anchor" aria-label="anchor" href="#bal-tab"></a>
</h2>
<p>To examine balance on the original data, we can specify the treatment-covariate relationship we want to assess by using either the formula or data frame interfaces to <code><a href="../reference/bal.tab.html">bal.tab()</a></code>. The formula interface requires a list of formulas, one for each treatment, and a data set containing the relevant variables. The data set must be in the “wide” setup, where each time point receives its own columns and each unit has exactly one row of data. The formula interface is similar to the <code>WeightIt</code> input seen above. The data frame interface requires a list of treatment values for each time point and a data frame or list of covariates for each time point. We’ll use the data frame interface here.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">iptwExWide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"use0"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>             <span class="va">iptwExWide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"use0"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>, <span class="st">"use1"</span>, <span class="st">"tx1"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>             <span class="va">iptwExWide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"use0"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>, <span class="st">"use1"</span>, <span class="st">"tx1"</span>, <span class="st">"use2"</span>, <span class="st">"tx2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        treat.list <span class="op">=</span> <span class="va">iptwExWide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tx1"</span>, <span class="st">"tx2"</span>, <span class="st">"tx3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance summary across all time points</span></span></span>
<span><span class="co">##          Times    Type Max.Diff.Un</span></span>
<span><span class="co">## use0   1, 2, 3 Contin.      0.2668</span></span>
<span><span class="co">## gender 1, 2, 3  Binary      0.2945</span></span>
<span><span class="co">## age    1, 2, 3 Contin.      0.3799</span></span>
<span><span class="co">## use1      2, 3 Contin.      0.1662</span></span>
<span><span class="co">## tx1       2, 3  Binary      0.1695</span></span>
<span><span class="co">## use2         3 Contin.      0.1087</span></span>
<span><span class="co">## tx2          3  Binary      0.2423</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 1</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All     294     706</span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 2</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All     492     508</span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 3</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All     415     585</span></span></code></pre>
<p>Here we see a summary of balance across all time points. This displays each variable, how many times it appears in balance tables, its type, and the greatest imbalance for that variable across all time points. Below this is a summary of sample sizes across time points. To request balance on individual time points, we can use the <code>which.time</code> argument, which can be set to one or more numbers or <code>.all</code> or <code>.none</code> (the default). Below we’ll request balance on all time points by setting <code>which.time = .all</code>. Doing so hides the balance summary across time points, but this can be requested again by setting <code>msm.summary = TRUE</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">iptwExWide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"use0"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>             <span class="va">iptwExWide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"use0"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>, <span class="st">"use1"</span>, <span class="st">"tx1"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>             <span class="va">iptwExWide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"use0"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>, <span class="st">"use1"</span>, <span class="st">"tx1"</span>, <span class="st">"use2"</span>, <span class="st">"tx2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        treat.list <span class="op">=</span> <span class="va">iptwExWide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tx1"</span>, <span class="st">"tx2"</span>, <span class="st">"tx3"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        which.time <span class="op">=</span> <span class="va">.all</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance by Time Point</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 1</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##           Type Diff.Un</span></span>
<span><span class="co">## use0   Contin.  0.2668</span></span>
<span><span class="co">## gender  Binary  0.2945</span></span>
<span><span class="co">## age    Contin.  0.3799</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All     294     706</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 2</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##           Type Diff.Un</span></span>
<span><span class="co">## use0   Contin.  0.1169</span></span>
<span><span class="co">## gender  Binary  0.1927</span></span>
<span><span class="co">## age    Contin.  0.2240</span></span>
<span><span class="co">## use1   Contin.  0.0848</span></span>
<span><span class="co">## tx1     Binary  0.1695</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All     492     508</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 3</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##           Type Diff.Un</span></span>
<span><span class="co">## use0   Contin.  0.1859</span></span>
<span><span class="co">## gender  Binary  0.1532</span></span>
<span><span class="co">## age    Contin.  0.3431</span></span>
<span><span class="co">## use1   Contin.  0.1662</span></span>
<span><span class="co">## tx1     Binary  0.1071</span></span>
<span><span class="co">## use2   Contin.  0.1087</span></span>
<span><span class="co">## tx2     Binary  0.2423</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All     415     585</span></span>
<span><span class="co">##  - - - - - - - - - - -</span></span></code></pre>
<p>Here we see balance by time point. At each time point, a <code>bal.tab</code> object is produced for that time point. These function just like regular <code>bal.tab</code> objects.</p>
<p>This output will appear no matter what the treatment types are (i.e., binary, continuous, multi-category), but for multi-category treatments or when the treatment types vary or for multiply imputed data, no balance summary will be computed or displayed.</p>
<p>We can use <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with the <code>weightitMSM</code> object generated above. Setting <code>un = TRUE</code> would produce balance statistics before adjustment, like we did before. We’ll set <code>which.time = .all</code> and <code>msm.summary = TRUE</code> to see balance for each time point and across time points.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">Wmsm</span>, un <span class="op">=</span> <span class="cn">TRUE</span>, which.time <span class="op">=</span> <span class="va">.all</span>, msm.summary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Call</span></span></span>
<span><span class="co">##  WeightIt::weightitMSM(formula.list = list(tx1 ~ use0 + gender + </span></span>
<span><span class="co">##     age, tx2 ~ use0 + gender + age + use1 + tx1, tx3 ~ use0 + </span></span>
<span><span class="co">##     gender + age + use1 + tx1 + use2 + tx2), data = iptwExWide, </span></span>
<span><span class="co">##     method = "ps")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance by Time Point</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 1</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Un Diff.Adj</span></span>
<span><span class="co">## prop.score Distance  0.7862   0.0251</span></span>
<span><span class="co">## use0        Contin.  0.2668   0.0558</span></span>
<span><span class="co">## gender       Binary  0.2945   0.0224</span></span>
<span><span class="co">## age         Contin.  0.3799  -0.0019</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  294.     706. </span></span>
<span><span class="co">## Adjusted    185.18   573.6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 2</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Un Diff.Adj</span></span>
<span><span class="co">## prop.score Distance  0.5288  -0.0065</span></span>
<span><span class="co">## use0        Contin.  0.1169  -0.0327</span></span>
<span><span class="co">## gender       Binary  0.1927  -0.0117</span></span>
<span><span class="co">## age         Contin.  0.2240   0.0703</span></span>
<span><span class="co">## use1        Contin.  0.0848  -0.0311</span></span>
<span><span class="co">## tx1          Binary  0.1695  -0.0088</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   492.   508.  </span></span>
<span><span class="co">## Adjusted     318.9  264.49</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">Time: 3</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Un Diff.Adj</span></span>
<span><span class="co">## prop.score Distance  0.6565   0.0229</span></span>
<span><span class="co">## use0        Contin.  0.1859  -0.0347</span></span>
<span><span class="co">## gender       Binary  0.1532   0.0263</span></span>
<span><span class="co">## age         Contin.  0.3431   0.0182</span></span>
<span><span class="co">## use1        Contin.  0.1662  -0.0316</span></span>
<span><span class="co">## tx1          Binary  0.1071  -0.0171</span></span>
<span><span class="co">## use2        Contin.  0.1087  -0.0315</span></span>
<span><span class="co">## tx2          Binary  0.2423   0.0085</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  415.     585. </span></span>
<span><span class="co">## Adjusted    235.67   366.4</span></span>
<span><span class="co">##  - - - - - - - - - - - </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance summary across all time points</span></span></span>
<span><span class="co">##              Times     Type Max.Diff.Un Max.Diff.Adj</span></span>
<span><span class="co">## prop.score 1, 2, 3 Distance      0.7862       0.0251</span></span>
<span><span class="co">## use0       1, 2, 3  Contin.      0.2668       0.0558</span></span>
<span><span class="co">## gender     1, 2, 3   Binary      0.2945       0.0263</span></span>
<span><span class="co">## age        1, 2, 3  Contin.      0.3799       0.0703</span></span>
<span><span class="co">## use1          2, 3  Contin.      0.1662       0.0316</span></span>
<span><span class="co">## tx1           2, 3   Binary      0.1695       0.0171</span></span>
<span><span class="co">## use2             3  Contin.      0.1087       0.0315</span></span>
<span><span class="co">## tx2              3   Binary      0.2423       0.0085</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 1</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  294.     706. </span></span>
<span><span class="co">## Adjusted    185.18   573.6</span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 2</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   492.   508.  </span></span>
<span><span class="co">## Adjusted     318.9  264.49</span></span>
<span><span class="co">##  - <span style="font-style: italic;">Time 3</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  415.     585. </span></span>
<span><span class="co">## Adjusted    235.67   366.4</span></span></code></pre>
<p>Note that to add covariates, we must use <code>addl.list</code> (which can be abbreviated as <code>addl</code>), which functions like <code>addl</code> in point treatments. The input to <code>addl.list</code> must be a list of covariates for each time point, or a single data data frame of variables to be assessed at all time points. The same goes for adding distance variables, which must be done with <code>distance.list</code> (which can be abbreviated as <code>distance</code>).</p>
<p>Next we’ll use <code><a href="../reference/bal.plot.html">bal.plot()</a></code> to more finely examine covariate balance.</p>
</div>
<div class="section level2">
<h2 id="bal-plot">
<code>bal.plot()</code><a class="anchor" aria-label="anchor" href="#bal-plot"></a>
</h2>
<p>We can compare distributions of covariates across treatment groups for each time point using <code><a href="../reference/bal.plot.html">bal.plot()</a></code>, just as we could with point treatments.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.plot.html">bal.plot</a></span><span class="op">(</span><span class="va">Wmsm</span>, var.name <span class="op">=</span> <span class="st">"age"</span>, which <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cobalt_A3_longitudinal_treat_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
<p>Balance for variables that only appear in certain time points will only be displayed at those time points:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.plot.html">bal.plot</a></span><span class="op">(</span><span class="va">Wmsm</span>, var.name <span class="op">=</span> <span class="st">"tx1"</span>, which <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cobalt_A3_longitudinal_treat_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
<p>As with <code><a href="../reference/bal.tab.html">bal.tab()</a></code>, <code>which.time</code> can be specified to limit output to chosen time points.</p>
<p>Finally, we’ll examine using <code><a href="../reference/love.plot.html">love.plot()</a></code> with longitudinal treatments to display balance for presentation.</p>
</div>
<div class="section level2">
<h2 id="love-plot">
<code>love.plot()</code><a class="anchor" aria-label="anchor" href="#love-plot"></a>
</h2>
<p><code><a href="../reference/love.plot.html">love.plot()</a></code> works with longitudinal treatments just as it does with point treatments, except that the user can choose whether to display separate plots for each time point or one plot with the summary across time points. As with <code><a href="../reference/bal.tab.html">bal.tab()</a></code>, the user can set <code>which.time</code> to display only certain time points. When set to <code>.none</code>, the summary across time points is displayed. The <code>agg.fun</code> argument is set to <code>"max"</code> by default.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/love.plot.html">love.plot</a></span><span class="op">(</span><span class="va">Wmsm</span>, abs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Standardized mean differences and raw mean differences are present in the same plot. </span></span>
<span><span class="co">## Use the 'stars' argument to distinguish between them and appropriately label the x-axis.</span></span></code></pre>
<p><img src="cobalt_A3_longitudinal_treat_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/love.plot.html">love.plot</a></span><span class="op">(</span><span class="va">Wmsm</span>, which.time <span class="op">=</span> <span class="va">.none</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Standardized mean differences and raw mean differences are present in the same plot. </span></span>
<span><span class="co">## Use the 'stars' argument to distinguish between them and appropriately label the x-axis.</span></span></code></pre>
<p><img src="cobalt_A3_longitudinal_treat_files/figure-html/unnamed-chunk-10-1.png" width="384"></p>
</div>
<div class="section level2">
<h2 id="other-packages">Other Packages<a class="anchor" aria-label="anchor" href="#other-packages"></a>
</h2>
<p>Here we used <code>WeightIt</code> to generate our MSM weights, but <code>cobalt</code> is compatible with other packages for longitudinal treatments as well. <code>CBMSM</code> objects from the <code>CBPS</code> package and <code>iptw</code> objects from the <code>twang</code> package can be used in place of the <code>weightitMSM</code> object in the above examples. In addition, users who have generated balancing weights outside any of these package can specify an argument to <code>weights</code> in <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with the formula or data frame methods to assess balance using those weights, or they can use the default method of <code><a href="../reference/bal.tab.html">bal.tab()</a></code> to supply an object containing any of the objects required for balance assessment (output from <code>optweight</code> is particularly well suited for this).</p>
<p>Note that <code>CBPS</code> estimates and assesses balance on MSM weights differently from <code>twang</code> and <code>cobalt</code>. Its focus is on ensuring balance across all treatment history permutations, whereas <code>cobalt</code> focuses on evaluating the similarity to sequential randomization. For this reason, it may appear that <code>CBMSM</code> objects have different balance qualities as measured by the two packages.</p>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-coleConstructingInverseProbability2008">
<p>Cole, Stephen R., and Miguel A Hernán. 2008. “Constructing Inverse Probability Weights for Marginal Structural Models.” <em>American Journal of Epidemiology</em> 168 (6): 656–64. <a href="https://doi.org/10.1093/aje/kwn164" class="external-link">https://doi.org/10.1093/aje/kwn164</a>.</p>
</div>
<div id="ref-robinsMarginalStructuralModels2000">
<p>Robins, James M., Miguel Ángel Hernán, and Babette Brumback. 2000. “Marginal Structural Models and Causal Inference in Epidemiology.” <em>Epidemiology</em> 11 (5): 550–60. <a href="https://doi.org/10.2307/3703997" class="external-link">https://doi.org/10.2307/3703997</a>.</p>
</div>
<div id="ref-thoemmesPrimerInverseProbability2016">
<p>Thoemmes, Felix J., and Anthony D. Ong. 2016. “A Primer on Inverse Probability of Treatment Weighting and Marginal Structural Models.” <em>Emerging Adulthood</em> 4 (1): 40–59. <a href="https://doi.org/10.1177/2167696815621645" class="external-link">https://doi.org/10.1177/2167696815621645</a>.</p>
</div>
<div id="ref-vanderweeleCausalInferenceLongitudinal2016">
<p>VanderWeele, Tyler J., John W. Jackson, and Shanshan Li. 2016. “Causal Inference and Longitudinal Data: A Case Study of Religion and Mental Health.” <em>Social Psychiatry and Psychiatric Epidemiology</em> 51 (11): 1457–66. <a href="https://doi.org/10.1007/s00127-016-1281-9" class="external-link">https://doi.org/10.1007/s00127-016-1281-9</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
