<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cobalt">
<title>Appendix 1: Using cobalt with Other Preprocessing Packages • cobalt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Appendix 1: Using cobalt with Other Preprocessing Packages">
<meta property="og:description" content="cobalt">
<meta property="og:image" content="https://ngreifer.github.io/cobalt/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cobalt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.4.0.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/cobalt.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cobalt_A1_other_packages.html">Appendix 1: Using cobalt with Other Preprocessing Packages</a>
    <a class="dropdown-item" href="../articles/cobalt_A2_segmented_data.html">Appendix 2: Using cobalt with Clustered, Multiply Imputed, and Other Segmented Data</a>
    <a class="dropdown-item" href="../articles/cobalt_A3_longitudinal_treat.html">Appendix 3: Using cobalt with Longitudinal Treatments</a>
    <a class="dropdown-item" href="../articles/cobalt_A4_love.plot.html">Appendix 4: Using love.plot To Generate Love Plots</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ngreifer/cobalt/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Appendix 1: Using cobalt with Other Preprocessing Packages</h1>
                        <h4 data-toc-skip class="author">Noah
Greifer</h4>
            
            <h4 data-toc-skip class="date">2022-10-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/cobalt/blob/HEAD/vignettes/cobalt_A1_other_packages.Rmd" class="external-link"><code>vignettes/cobalt_A1_other_packages.Rmd</code></a></small>
      <div class="d-none name"><code>cobalt_A1_other_packages.Rmd</code></div>
    </div>

    
    
<p>This is an appendix to the main vignette, “Covariate Balance Tables
and Plots: A Guide to the cobalt Package”. It contains descriptions and
demonstrations of several utility functions in <code>cobalt</code> and
the use of <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with <code>twang</code>,
<code>Matching</code>, <code>optmatch</code>, <code>CBPS</code>,
<code>ebal</code>, <code>designmatch</code>, <code>sbw</code>,
<code>MatchThem</code>, and <code>cem</code>. Note that
<code>MatchIt</code> can perform most of the functions that
<code>Matching</code>, <code>optmatch</code>, and <code>cem</code> can,
and <code>WeightIt</code> can perform most of the functions that
<code>twang</code>, <code>CBPS</code>, <code>ebal</code>, and
<code>sbw</code> can. Because <code>cobalt</code> has been optimized to
work with <code>MatchIt</code> and <code>WeightIt</code>, it is
recommended to use those packages to simplify preprocessing and balance
assessment, but we recognize users may prefer to use the packages
described in this vignette.</p>
<div class="section level2">
<h2 id="utilities">Utilities<a class="anchor" aria-label="anchor" href="#utilities"></a>
</h2>
<p>In addition to its main balance assessment functions,
<code>cobalt</code> contains several utility functions. These are meant
to reduce the typing and programming burden that often accompany the use
of R with a diverse set of packages.</p>
<div class="section level3">
<h3 id="splitfactor-and-unsplitfactor">
<code>splitfactor()</code> and <code>unsplitfactor()</code><a class="anchor" aria-label="anchor" href="#splitfactor-and-unsplitfactor"></a>
</h3>
<p>Some functions (outside of <code>cobalt</code>) are not friendly to
factor or character variables, and require numeric variables to operate
correctly. For example, some regression-style functions, such as
<code><a href="https://rdrr.io/pkg/ebal/man/ebalance.html" class="external-link">ebalance()</a></code> in <code>ebal</code>, can only take in
non-singular numeric matrices. Other functions will process factor
variables, but will return output in terms of dummy coded version of the
factors. For example, <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> will create dummy variables out
of a factor and drop the reference category to create regression
coefficients.</p>
<p>To prepare data sets for use in functions that do not allow factors
or to mimic the output of functions that split factor variables, users
can use <code><a href="../reference/splitfactor.html">splitfactor()</a></code>, which takes in a data set and the
names of variables to split, and outputs a new data set with newly
created dummy variables. Below is an example splitting the
<code>race</code> variable in the Lalonde data set into dummies,
eliminating the reference category (<code>"black"</code>):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   treat age educ   race married nodegree re74 re75       re78</span></span>
<span><span class="co">## 1     1  37   11  black       1        1    0    0  9930.0460</span></span>
<span><span class="co">## 2     1  22    9 hispan       0        1    0    0  3595.8940</span></span>
<span><span class="co">## 3     1  30   12  black       0        0    0    0 24909.4500</span></span>
<span><span class="co">## 4     1  27   11  black       0        1    0    0  7506.1460</span></span>
<span><span class="co">## 5     1  33    8  black       0        1    0    0   289.7899</span></span>
<span><span class="co">## 6     1  22    9  black       0        1    0    0  4056.4940</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lalonde.split</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splitfactor.html">splitfactor</a></span><span class="op">(</span><span class="va">lalonde</span>, <span class="st">"race"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lalonde.split</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   treat age educ race_hispan race_white married nodegree re74 re75       re78</span></span>
<span><span class="co">## 1     1  37   11           0          0       1        1    0    0  9930.0460</span></span>
<span><span class="co">## 2     1  22    9           1          0       0        1    0    0  3595.8940</span></span>
<span><span class="co">## 3     1  30   12           0          0       0        0    0    0 24909.4500</span></span>
<span><span class="co">## 4     1  27   11           0          0       0        1    0    0  7506.1460</span></span>
<span><span class="co">## 5     1  33    8           0          0       0        1    0    0   289.7899</span></span>
<span><span class="co">## 6     1  22    9           0          0       0        1    0    0  4056.4940</span></span></code></pre>
<p>It is possible to undo the action of <code><a href="../reference/splitfactor.html">splitfactor()</a></code> with
<code><a href="../reference/splitfactor.html">unsplitfactor()</a></code>, which takes in a data set with dummy
variables formed from <code><a href="../reference/splitfactor.html">splitfactor()</a></code> or otherwise and
recreates the original factor variable. If the reference category was
dropped, its value needs to be supplied.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lalonde.unsplit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splitfactor.html">unsplitfactor</a></span><span class="op">(</span><span class="va">lalonde.split</span>, <span class="st">"race"</span>, </span>
<span>                                 dropped.level <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lalonde.unsplit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   treat age educ   race married nodegree re74 re75       re78</span></span>
<span><span class="co">## 1     1  37   11  black       1        1    0    0  9930.0460</span></span>
<span><span class="co">## 2     1  22    9 hispan       0        1    0    0  3595.8940</span></span>
<span><span class="co">## 3     1  30   12  black       0        0    0    0 24909.4500</span></span>
<span><span class="co">## 4     1  27   11  black       0        1    0    0  7506.1460</span></span>
<span><span class="co">## 5     1  33    8  black       0        1    0    0   289.7899</span></span>
<span><span class="co">## 6     1  22    9  black       0        1    0    0  4056.4940</span></span></code></pre>
<p>Notice the original data set and the unsplit data set look identical.
If the input to <code><a href="../reference/splitfactor.html">unsplitfactor()</a></code> is the output of a call to
<code><a href="../reference/splitfactor.html">splitfactor()</a></code> (as it was here), you don’t need to tell
<code><a href="../reference/splitfactor.html">unsplitfactor()</a></code> the name of the split variable or the value
of the dropped level. It was done here for illustration purposes.</p>
</div>
<div class="section level3">
<h3 id="get-w">
<code>get.w()</code><a class="anchor" aria-label="anchor" href="#get-w"></a>
</h3>
<p><code><a href="../reference/get.w.html">get.w()</a></code> allows users to extract weights from the output
of a call to a preprocessing function in one of the supported packages.
Because each package stores weights in different ways, it can be helpful
to have a single function that applies equally to all outputs.
<code>twang</code> has a function called <code><a href="https://rdrr.io/pkg/twang/man/get.weights.html" class="external-link">get.weights()</a></code> that
performs the same functions with slightly finer control for the output
of a call to <code><a href="https://rdrr.io/pkg/twang/man/ps.html" class="external-link">ps()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="bal-tab">
<code>bal.tab()</code><a class="anchor" aria-label="anchor" href="#bal-tab"></a>
</h2>
<p>The next sections describe the use of <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with
packages other than those described in the main vignette. Even if you
are using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with one of these packages, it may be
useful to read the main vignette to understand <code><a href="../reference/bal.tab.html">bal.tab()</a></code>’s
main options, which are not detailed here.</p>
<div class="section level3">
<h3 id="using-bal-tab-with-twang">Using <code>bal.tab()</code> with <code>twang</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-twang"></a>
</h3>
<p>Generalized boosted modeling (GBM), as implemented in
<code>twang</code>, can be an effective way to generate propensity
scores and weights for use in propensity score weighting.
<code><a href="../reference/bal.tab.html">bal.tab()</a></code> functions similarly to the functions
<code><a href="https://rdrr.io/pkg/twang/man/bal.table.html" class="external-link">bal.table()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> when used with GBM
in <code>twang</code>. Below is a simple example of its use:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#GBM PS weighting for the ATT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span> <span class="co">##If not yet loaded</span></span>
<span><span class="va">covs0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">re78</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/delete.response.html" class="external-link">reformulate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">covs0</span><span class="op">)</span>, <span class="st">"treat"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps.out</span> <span class="op">&lt;-</span> <span class="fu">twang</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/twang/man/ps.html" class="external-link">ps</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">lalonde</span>, </span>
<span>                    stop.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"es.mean"</span>, <span class="st">"es.max"</span><span class="op">)</span>, </span>
<span>                    estimand <span class="op">=</span> <span class="st">"ATT"</span>, n.trees <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">ps.out</span>, stop.method <span class="op">=</span> <span class="st">"es.mean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                 Type Diff.Adj</span></span>
<span><span class="co">## prop.score  Distance   0.5189</span></span>
<span><span class="co">## age          Contin.   0.0400</span></span>
<span><span class="co">## educ         Contin.  -0.0819</span></span>
<span><span class="co">## race_black    Binary   0.0250</span></span>
<span><span class="co">## race_hispan   Binary  -0.0008</span></span>
<span><span class="co">## race_white    Binary  -0.0242</span></span>
<span><span class="co">## married       Binary  -0.0116</span></span>
<span><span class="co">## nodegree      Binary   0.0864</span></span>
<span><span class="co">## re74         Contin.   0.0691</span></span>
<span><span class="co">## re75         Contin.   0.0953</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  429.       185</span></span>
<span><span class="co">## Adjusted     33.03     185</span></span></code></pre>
<p>The output looks a bit different from <code>twang</code>’s
<code><a href="https://rdrr.io/pkg/twang/man/bal.table.html" class="external-link">bal.table()</a></code> output. First is the original call to
<code><a href="https://rdrr.io/pkg/twang/man/ps.html" class="external-link">ps()</a></code>. Next is the balance table containing mean differences
for the covariates included in the input to <code><a href="https://rdrr.io/pkg/twang/man/ps.html" class="external-link">ps()</a></code>. Last is a
table displaying sample size information, similar to what would be
generated using <code>twang</code>’s <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function.
The “effective” sample size is displayed when weighting is used; it is
calculated as is done in <code>twang</code>. See the <code>twang</code>
documentation, <code><a href="../reference/bal.tab.html">?bal.tab</a></code>, or “Details on Calculations” in
the main vignette for details on this calculation.</p>
<p>When using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with <code>twang</code>, the user
must specify the <code>ps</code> object, the output of a call to
<code><a href="https://rdrr.io/pkg/twang/man/ps.html" class="external-link">ps()</a></code>, as the first argument. The second argument,
<code>stop.method</code>, is the name of the stop method(s) for which
balance is to be assessed, since a <code>ps</code> object may contain
more than one if so specified. <code><a href="../reference/bal.tab.html">bal.tab()</a></code> can display the
balance for more than one stop method at a time by specifying a vector
of stop method names. If this argument is left empty or if the argument
to <code>stop.method</code> does not correspond to any of the stop
methods in the <code>ps</code> object, <code><a href="../reference/bal.tab.html">bal.tab()</a></code> will
default to displaying balance for all stop methods available.
Abbreviations are allowed for the stop method, which is not case
sensitive.</p>
<p>The other arguments to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> when using it with
<code>twang</code> have the same form and function as those given when
using it without a conditioning package, except for
<code>s.d.denom</code>. If the estimand of the stop method used is the
ATT, <code>s.d.denom</code> will default to <code>"treated"</code> if
not specified, and if the estimand is the ATE, <code>s.d.denom</code>
will default to <code>"pooled"</code>, mimicking the behavior of
<code>twang</code>. The user can specify their own argument to
<code>s.d.denom</code>, but using the defaults is advised.</p>
<p>If sampling weights are used in the call to <code><a href="https://rdrr.io/pkg/twang/man/ps.html" class="external-link">ps()</a></code>, they
will be automatically incorporated into the <code><a href="../reference/bal.tab.html">bal.tab()</a></code>
calculations for both the adjusted and unadjusted samples, just as
<code>twang</code> does.</p>
<p><code>mnps</code> objects resulting from fitting models in
<code>twang</code> with multi-category treatments are also compatible
with <code>cobalt</code>. See the section “Using <code>cobalt</code>
with multi-category treatments” in the main vignette. <code>iptw</code>
objects resulting from fitting models in <code>twang</code> with
longitudinal treatments are also compatible with <code>cobalt</code>.
See the Appendix 3 vignette. <code>ps.cont</code> objects resulting from
using <code>ps.cont()</code> in <code>WeightIt</code>, which implements
GBM for continuous treatments, are also compatible. See the section
“Using <code>cobalt</code> with continuous treatments” in the main
vignette.</p>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-matching">Using <code>bal.tab()</code> with <code>Matching</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-matching"></a>
</h3>
<p>The <code>Matching</code> package is used for propensity score
matching, and was also the first package to implement genetic matching.
<code>MatchIt</code> calls <code>Matching</code> to use genetic matching
and can accomplish many of the matching methods <code>Matching</code>
can, but <code>Matching</code> is still a widely used package with its
own strengths. <code><a href="../reference/bal.tab.html">bal.tab()</a></code> functions similarly to
<code>Matching</code>’s <code><a href="https://rdrr.io/pkg/Matching/man/MatchBalance.html" class="external-link">MatchBalance()</a></code> command, which
yields a thorough presentation of balance. Below is a simple example of
the use of <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with <code>Matching</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#1:1 NN PS matching w/ replacement</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span> <span class="co">#If not yet loaded</span></span>
<span><span class="va">covs0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">re78</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/delete.response.html" class="external-link">reformulate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">covs0</span><span class="op">)</span>, <span class="st">"treat"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">lalonde</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="va">p.score</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">fitted.values</span></span>
<span><span class="va">match.out</span> <span class="op">&lt;-</span> <span class="fu">Matching</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matching/man/Match.html" class="external-link">Match</a></span><span class="op">(</span>Tr <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>, X <span class="op">=</span> <span class="va">p.score</span>,</span>
<span>                             estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">match.out</span>, formula <span class="op">=</span> <span class="va">f</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>        distance <span class="op">=</span> <span class="op">~</span> <span class="va">p.score</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                 Type Diff.Adj</span></span>
<span><span class="co">## p.score     Distance   0.0043</span></span>
<span><span class="co">## age          Contin.   0.2106</span></span>
<span><span class="co">## educ         Contin.   0.0201</span></span>
<span><span class="co">## race_black    Binary   0.0054</span></span>
<span><span class="co">## race_hispan   Binary  -0.0051</span></span>
<span><span class="co">## race_white    Binary  -0.0003</span></span>
<span><span class="co">## married       Binary   0.0661</span></span>
<span><span class="co">## nodegree      Binary  -0.0079</span></span>
<span><span class="co">## re74         Contin.  -0.0772</span></span>
<span><span class="co">## re75         Contin.  -0.0127</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##                      Control Treated</span></span>
<span><span class="co">## All                   429.       185</span></span>
<span><span class="co">## Matched (ESS)          49.17     185</span></span>
<span><span class="co">## Matched (Unweighted)  136.       185</span></span>
<span><span class="co">## Unmatched             293.         0</span></span></code></pre>
<p>The output looks quite different from <code>Matching</code>’s
<code><a href="https://rdrr.io/pkg/Matching/man/MatchBalance.html" class="external-link">MatchBalance()</a></code> output. Rather than being stacked
vertically, balance statistics are arranged horizontally in a table
format, allowing for quick balance checking. Below the balance table is
a summary of the sample size before and after matching, similar to what
<code>Matching</code>’s <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> command would display.
The sample size can include an “ESS” and “unweighted” value; the “ESS”
value is the effective sample size resulting from the matching weights,
while the “unweighted” is the count of units with nonzero matching
weights.</p>
<p>The input to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> is similar to that given to
<code><a href="https://rdrr.io/pkg/Matching/man/MatchBalance.html" class="external-link">MatchBalance()</a></code>: the <code>Match</code> object resulting
from the call to <code><a href="https://rdrr.io/pkg/Matching/man/Match.html" class="external-link">Match()</a></code>, a formula relating treatment to
the covariates for which balance is to be assessed, and the original
data set. This is not the only way to call <code><a href="../reference/bal.tab.html">bal.tab()</a></code>:
instead of a formula and a data set, one can also input a data frame of
covariates and a vector of treatment status indicators, just as when
using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> without a conditioning package. For
example, the code below will yield the same results as the call to
<code><a href="../reference/bal.tab.html">bal.tab()</a></code> above:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">match.out</span>, treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>, covs <span class="op">=</span> <span class="va">covs0</span>,</span>
<span>        distance <span class="op">=</span> <span class="op">~</span> <span class="va">p.score</span><span class="op">)</span></span></code></pre></div>
<p>The other arguments to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> when using it with
<code>Matching</code> have the same form and function as those given
when using it without a conditioning package, except for
<code>s.d.denom</code>. If the estimand of the original call to
<code><a href="https://rdrr.io/pkg/Matching/man/Match.html" class="external-link">Match()</a></code> is the ATT, <code>s.d.denom</code> will default to
<code>"treated"</code> if not specified; if the estimand is the ATE,
<code>s.d.denom</code> will default to <code>"pooled"</code>; if the
estimand is the ATC, <code>s.d.denom</code> will default to
<code>"control"</code>. The user can specify their own argument to
<code>s.d.denom</code>, but using the defaults is advisable. In
addition, the use of the <code>addl</code> argument is unnecessary
because the covariates are entered manually as arguments, so all
covariates for which balance is to be assessed can be entered through
the <code>formula</code> or <code>covs</code> argument. If the
covariates are stored in two separate data frames, it may be useful to
include one in <code>formula</code> or <code>covs</code> and the other
in <code>addl</code>.</p>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-optmatch">Using <code>bal.tab()</code> with <code>optmatch</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-optmatch"></a>
</h3>
<p>The <code>optmatch</code> package is useful for performing optimal
pairwise or full matching. Most functions in <code>optmatch</code> are
subsumed in <code>MatchIt</code>, but <code>optmatch</code> sees use
from those who want finer control of the matching process than
<code>MatchIt</code> allows. The output of calls to functions in
<code>optmatch</code> is an <code>optmatch</code> object, which contains
matching stratum membership for each unit in the given data set. Units
that are matched with each other are assigned the same matching stratum.
The user guide for <code>optmatch</code> recommends using the
<code>RItools</code> package for balance assessment, but below is an
example of how to use <code><a href="../reference/bal.tab.html">bal.tab()</a></code> for the same purpose. Note
that some results will differ between <code>cobalt</code> and
<code>RItools</code> because of differences in how balance is calculated
in each.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Optimal full matching on the propensity score</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span> <span class="co">#If not yet loaded</span></span>
<span><span class="va">covs0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">re78</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/delete.response.html" class="external-link">reformulate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">covs0</span><span class="op">)</span>, <span class="st">"treat"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">lalonde</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="va">p.score</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">fitted.values</span> <span class="co">#get the propensity score</span></span>
<span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu">optmatch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">fullmatch</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">p.score</span>, data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">fm</span>, covs <span class="op">=</span> <span class="va">covs0</span>, distance <span class="op">=</span> <span class="op">~</span> <span class="va">p.score</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Call</span></span></span>
<span><span class="co">##  optmatch::fullmatch(x = treat ~ p.score, data = lalonde)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                 Type Diff.Adj</span></span>
<span><span class="co">## p.score     Distance   0.0058</span></span>
<span><span class="co">## age          Contin.   0.1522</span></span>
<span><span class="co">## educ         Contin.  -0.0314</span></span>
<span><span class="co">## race_black    Binary   0.0086</span></span>
<span><span class="co">## race_hispan   Binary  -0.0014</span></span>
<span><span class="co">## race_white    Binary  -0.0071</span></span>
<span><span class="co">## married       Binary   0.0573</span></span>
<span><span class="co">## nodegree      Binary   0.0072</span></span>
<span><span class="co">## re74         Contin.  -0.0631</span></span>
<span><span class="co">## re75         Contin.  -0.0138</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##                      Control Treated</span></span>
<span><span class="co">## All                   429.       185</span></span>
<span><span class="co">## Matched (ESS)          51.42     185</span></span>
<span><span class="co">## Matched (Unweighted)  429.       185</span></span></code></pre>
<p>Most details for the use of <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with
<code>optmatch</code> are similar to those when using
<code><a href="../reference/bal.tab.html">bal.tab()</a></code> with <code>Matching</code>. Users can enter
either a formula and a data set or a vector of treatment status and a
set of covariates. Unlike with <code>Matching</code>, entering the
treatment variable is optional as it is already stored in the
<code>optmatch</code> object. <code><a href="../reference/bal.tab.html">bal.tab()</a></code> is compatible with
both <code><a href="https://rdrr.io/pkg/optmatch/man/pairmatch.html" class="external-link">pairmatch()</a></code> and <code><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">fullmatch()</a></code> output.</p>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-cbps">Using <code>bal.tab()</code> with <code>CBPS</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-cbps"></a>
</h3>
<p>The <code>CBPS</code> (Covariate Balancing Propensity Score) package
is a great tool for generating covariate balancing propensity scores, a
class of propensity scores that are quite effective at balancing
covariates among groups. <code>CBPS</code> includes functions for
estimating propensity scores for binary, multi-category, and continuous
treatments. <code><a href="../reference/bal.tab.html">bal.tab()</a></code> functions similarly to
<code>CBPS</code>’s <code><a href="https://rdrr.io/pkg/CBPS/man/balance.html" class="external-link">balance()</a></code> command. Below is a simple
example of its use with a binary treatment:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#CBPS weighting</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span> <span class="co">#If not yet loaded</span></span>
<span><span class="va">covs0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">re78</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/delete.response.html" class="external-link">reformulate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">covs0</span><span class="op">)</span>, <span class="st">"treat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Generating covariate balancing propensity score weights for ATT</span></span>
<span><span class="va">cbps.out</span> <span class="op">&lt;-</span> <span class="fu">CBPS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/CBPS/man/CBPS.html" class="external-link">CBPS</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Finding ATT with T=1 as the treatment.  Set ATT=2 to find ATT with T=0 as the treatment"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">cbps.out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Call</span></span></span>
<span><span class="co">##  CBPS::CBPS(formula = f, data = lalonde)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                 Type Diff.Adj</span></span>
<span><span class="co">## prop.score  Distance  -0.0057</span></span>
<span><span class="co">## age          Contin.  -0.0052</span></span>
<span><span class="co">## educ         Contin.  -0.0017</span></span>
<span><span class="co">## race_black    Binary   0.0019</span></span>
<span><span class="co">## race_hispan   Binary  -0.0002</span></span>
<span><span class="co">## race_white    Binary  -0.0017</span></span>
<span><span class="co">## married       Binary  -0.0029</span></span>
<span><span class="co">## nodegree      Binary   0.0042</span></span>
<span><span class="co">## re74         Contin.  -0.0078</span></span>
<span><span class="co">## re75         Contin.   0.0061</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  429.       185</span></span>
<span><span class="co">## Adjusted     99.97     185</span></span></code></pre>
<p>First is the original call to <code><a href="https://rdrr.io/pkg/CBPS/man/CBPS.html" class="external-link">CBPS()</a></code>. Next is the
balance table containing mean differences for the covariates included in
the input to <code><a href="https://rdrr.io/pkg/CBPS/man/CBPS.html" class="external-link">CBPS()</a></code>. Last is a table displaying sample size
information. The “effective” sample size is displayed when weighting
(rather than matching or subclassification) is used; it is calculated as
is done in <code>twang</code>. See the <code>twang</code> documentation,
<code><a href="../reference/bal.tab.html">?bal.tab</a></code>, or “Details on Calculations” in the main vignette
for details on this calculation.</p>
<p>The other arguments to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> when using it with
<code>CBPS</code> have the same form and function as those given when
using it without a conditioning package, except for
<code>s.d.denom</code>. If the estimand of the original call to
<code><a href="https://rdrr.io/pkg/CBPS/man/CBPS.html" class="external-link">CBPS()</a></code> is the ATT, <code>s.d.denom</code> will default to
<code>"treated"</code> if not specified, and if the estimand is the ATE,
<code>s.d.denom</code> will default to <code>"pooled"</code>. The user
can specify their own argument to <code>s.d.denom</code>, but using the
defaults is advisable.</p>
<p><code>CBPSContinuous</code> objects resulting from fitting models in
<code>CBPS</code> with continuous treatments are also compatible with
<code>cobalt</code>. See the section “Using <code>cobalt</code> with
continuous treatments” in the main vignette. <code>CBPS</code> objects
resulting from fitting models in <code>CBPS</code> with multi-category
treatments are also compatible with <code>cobalt</code>. See the section
“Using <code>cobalt</code> with multi-category treatments” in the main
vignette. <code>CBMSM</code> objects resulting from fitting models in
<code>CBPS</code> with longitudinal treatments are also compatible with
<code>cobalt</code>. See the Appendix 3 vignette.</p>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-ebal">Using <code>bal.tab()</code> with <code>ebal</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-ebal"></a>
</h3>
<p>The <code>ebal</code> package implements entropy balancing, a method
of weighting for the ATT that yields perfect balance on all desired
moments of the covariate distributions between groups. Rather than
estimate a propensity score, entropy balancing generates weights
directly that satisfy a user-defined moment condition, specifying which
moments are to be balanced. Not that all the functionality of
<code>ebal</code> is contained within <code>Weightit</code>.
<code>ebal</code> does not have its own balance assessment function;
thus, <code>cobalt</code> is the only way to assess balance without
programming, which the <code>ebal</code> documentation instructs. Below
is a simple example of using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with
<code>ebal</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Entropy balancing</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span> <span class="co">#If not yet loaded</span></span>
<span><span class="va">covs0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">re78</span>, <span class="va">race</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Generating entropy balancing weights</span></span>
<span><span class="va">e.out</span> <span class="op">&lt;-</span> <span class="fu">ebal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ebal/man/ebalance.html" class="external-link">ebalance</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>, <span class="va">covs0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Converged within tolerance</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">e.out</span>, treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>, covs <span class="op">=</span> <span class="va">covs0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##             Type Diff.Adj</span></span>
<span><span class="co">## age      Contin.       -0</span></span>
<span><span class="co">## educ     Contin.       -0</span></span>
<span><span class="co">## married   Binary       -0</span></span>
<span><span class="co">## nodegree  Binary        0</span></span>
<span><span class="co">## re74     Contin.       -0</span></span>
<span><span class="co">## re75     Contin.       -0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  429.       185</span></span>
<span><span class="co">## Adjusted    247.64     185</span></span></code></pre>
<p>First is the balance table containing mean differences for covariates
included in the original call to <code>ebalance</code>. In general,
these will all be very close to 0. Next is a table displaying effective
sample size information. The “effective” sample size is calculated as is
done in <code>twang</code>. See the <code>twang</code> documentation,
<code><a href="../reference/bal.tab.html">?bal.tab</a></code>, or “Details on Calculations” in the main vignette
for details on this calculation. A common issue when using entropy
balancing is small effective sample size, which can yield low precision
in effect estimation when using weighted regression, so it is important
that users pay attention to this measure.</p>
<p>The input is similar to that for using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with
<code>Matching</code> or <code>optmatch</code>. In addition to the
<code>ebalance</code> object, one must specify either both a formula and
a data set or both a treatment vector and a data frame of
covariates.</p>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-designmatch">Using <code>bal.tab()</code> with <code>designmatch</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-designmatch"></a>
</h3>
<p>The <code>designmatch</code> package implements various matching
methods that use optimization to find matches that satisfy certain
balance constraints. <code><a href="../reference/bal.tab.html">bal.tab()</a></code> functions similarly to
<code>designmatch</code>’s <code><a href="https://rdrr.io/pkg/designmatch/man/meantab.html" class="external-link">meantab()</a></code> command but provides
additional flexibility and convenience. Below is a simple example of
using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with <code>designmatch</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Mixed integer programming matching</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"designmatch"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span> <span class="co">#If not yet loaded</span></span>
<span><span class="va">covs0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">re78</span>, <span class="va">race</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Matching for balance on covariates</span></span>
<span><span class="va">dmout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/designmatch/man/bmatch.html" class="external-link">bmatch</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>                dist_mat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                subset_weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                mom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>covs <span class="op">=</span> <span class="va">covs0</span>,</span>
<span>                           tols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/designmatch/man/absstddif.html" class="external-link">absstddif</a></span><span class="op">(</span><span class="va">covs0</span>, <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>, <span class="fl">.005</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                n_controls <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                total_groups <span class="op">=</span> <span class="fl">185</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Building the matching problem... </span></span>
<span><span class="co">##   GLPK optimizer is open... </span></span>
<span><span class="co">##   Finding the optimal matches... </span></span>
<span><span class="co">##   Optimal matches found</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">dmout</span>, treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span>, covs <span class="op">=</span> <span class="va">covs0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##             Type Diff.Adj</span></span>
<span><span class="co">## age      Contin.   0.0038</span></span>
<span><span class="co">## educ     Contin.   0.0054</span></span>
<span><span class="co">## married   Binary   0.0000</span></span>
<span><span class="co">## nodegree  Binary   0.0054</span></span>
<span><span class="co">## re74     Contin.  -0.0120</span></span>
<span><span class="co">## re75     Contin.  -0.0076</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##           Control Treated</span></span>
<span><span class="co">## All           429     185</span></span>
<span><span class="co">## Matched       185     185</span></span>
<span><span class="co">## Unmatched     244       0</span></span></code></pre>
<p>The input is similar to that for using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with
<code>Matching</code> or <code>optmatch</code>. In addition to the
<code>designmatch()</code> output object, one must specify either both a
formula and a data set or both a treatment vector and a data frame of
covariates. The output is similar to that of <code>optmatch</code>.</p>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-sbw">Using <code>bal.tab()</code> with <code>sbw</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-sbw"></a>
</h3>
<p>The <code>sbw</code> package implements optimization-based weighting
to estimate weights that satisfy certain balance constraints and have
minimal variance. <code><a href="../reference/bal.tab.html">bal.tab()</a></code> functions similarly to
<code>sbw</code>’s <code><a href="https://rdrr.io/pkg/sbw/man/summarize.html" class="external-link">summarize()</a></code> function but provides
additional flexibility and convenience. Below is a simple example of
using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with <code>sbw</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Optimization-based weighting</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span> <span class="co">#If not yet loaded</span></span>
<span><span class="va">lalonde_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splitfactor.html">splitfactor</a></span><span class="op">(</span><span class="va">lalonde</span>, drop.first <span class="op">=</span> <span class="st">"if2"</span><span class="op">)</span></span>
<span><span class="va">cov.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lalonde_split</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"treat"</span>, <span class="st">"re78"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Estimating balancing weights for the ATT</span></span>
<span><span class="va">sbw.out</span> <span class="op">&lt;-</span> <span class="fu">sbw</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sbw/man/sbw.html" class="external-link">sbw</a></span><span class="op">(</span><span class="va">lalonde_split</span>,</span>
<span>                    ind <span class="op">=</span> <span class="st">"treat"</span>,</span>
<span>                    bal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bal_cov <span class="op">=</span> <span class="va">cov.names</span>,</span>
<span>                               bal_alg <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                               bal_tol <span class="op">=</span> <span class="fl">.001</span><span class="op">)</span>,</span>
<span>                    par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>par_est <span class="op">=</span> <span class="st">"att"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   quadprog optimizer is opening... </span></span>
<span><span class="co">##   Finding the optimal weights... </span></span>
<span><span class="co">##   Optimal weights found.</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">sbw.out</span>, un <span class="op">=</span> <span class="cn">TRUE</span>, disp.means <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type    M.0.Un    M.1.Un Diff.Un   M.0.Adj   M.1.Adj Diff.Adj</span></span>
<span><span class="co">## age         Contin.   28.0303   25.8162 -0.3094   25.8054   25.8162   0.0015</span></span>
<span><span class="co">## educ        Contin.   10.2354   10.3459  0.0550   10.3431   10.3459   0.0014</span></span>
<span><span class="co">## race_black   Binary    0.2028    0.8432  0.6404    0.8428    0.8432   0.0004</span></span>
<span><span class="co">## race_hispan  Binary    0.1422    0.0595 -0.0827    0.0594    0.0595   0.0001</span></span>
<span><span class="co">## race_white   Binary    0.6550    0.0973 -0.5577    0.0978    0.0973  -0.0005</span></span>
<span><span class="co">## married      Binary    0.5128    0.1892 -0.3236    0.1897    0.1892  -0.0005</span></span>
<span><span class="co">## nodegree     Binary    0.5967    0.7081  0.1114    0.7076    0.7081   0.0005</span></span>
<span><span class="co">## re74        Contin. 5619.2365 2095.5737 -0.7211 2102.3624 2095.5737  -0.0014</span></span>
<span><span class="co">## re75        Contin. 2466.4844 1532.0553 -0.2903 1528.7633 1532.0553   0.0010</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  429.       185</span></span>
<span><span class="co">## Adjusted    108.99     185</span></span></code></pre>
<p>The output is similar to the output of a call to
<code><a href="https://rdrr.io/pkg/sbw/man/summarize.html" class="external-link">summarize()</a></code>. Rather than stack several balance tables
vertically, each with their own balance summary, here they are displayed
horizontally. Note that due to differences in how <code>sbw</code> and
<code>cobalt</code> compute the standardization factor in the
standardized mean difference, values may not be identical between
<code><a href="../reference/bal.tab.html">bal.tab()</a></code> and <code><a href="https://rdrr.io/pkg/sbw/man/summarize.html" class="external-link">summarize()</a></code>. Also note that
<code><a href="../reference/bal.tab.html">bal.tab()</a></code>’s default is to display raw rather than
standardized mean differences for binary variables.</p>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-matchthem">Using <code>bal.tab()</code> with <code>MatchThem</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-matchthem"></a>
</h3>
<p>The <code>MatchThem</code> package is essentially a wrapper for
<code><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">matchit()</a></code> from <code>MatchIt</code> and
<code><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit()</a></code> from <code>WeightIt</code> but for use with
multiply imputed data. Using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> on
<code>mimids</code> or <code>wimids</code> objects from
<code>MatchThem</code> activates the features that accompany multiply
imputed data; balance is assessed within each imputed dataset and
aggregated across imputations. See <code>?bal.tab.imp</code> or the
accompanying Appendix 2 for more information about using
<code>cobalt</code> with multiply imputed data. Below is a simple
example of using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with <code>MatchThem</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#PS weighting on multiply imputed data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde_mis"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Generate imputed data sets</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co">#number of imputed data sets</span></span>
<span><span class="va">imp.out</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">lalonde_mis</span>, m <span class="op">=</span> <span class="va">m</span>, print <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#Matching for balance on covariates</span></span>
<span><span class="va">wt.out</span> <span class="op">&lt;-</span> <span class="fu">MatchThem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MatchThem/man/weightthem.html" class="external-link">weightthem</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                                    <span class="va">race</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, </span>
<span>                                datasets <span class="op">=</span> <span class="va">imp.out</span>,</span>
<span>                                approach <span class="op">=</span> <span class="st">"within"</span>, </span>
<span>                                method <span class="op">=</span> <span class="st">"ps"</span>,</span>
<span>                                estimand <span class="op">=</span> <span class="st">"ATE"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">wt.out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance summary across all imputations</span></span></span>
<span><span class="co">##                 Type Min.Diff.Adj Mean.Diff.Adj Max.Diff.Adj</span></span>
<span><span class="co">## prop.score  Distance       0.1423        0.1553       0.1665</span></span>
<span><span class="co">## age          Contin.      -0.1935       -0.1868      -0.1819</span></span>
<span><span class="co">## educ         Contin.       0.0733        0.0827       0.0925</span></span>
<span><span class="co">## married       Binary      -0.1162       -0.1018      -0.0903</span></span>
<span><span class="co">## race_black    Binary       0.0512        0.0561       0.0611</span></span>
<span><span class="co">## race_hispan   Binary       0.0063        0.0098       0.0126</span></span>
<span><span class="co">## race_white    Binary      -0.0725       -0.0660      -0.0576</span></span>
<span><span class="co">## re74         Contin.      -0.3057       -0.2882      -0.2697</span></span>
<span><span class="co">## re75         Contin.      -0.1732       -0.1589      -0.1460</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Average effective sample sizes across imputations</span></span></span>
<span><span class="co">##                 0      1</span></span>
<span><span class="co">## Unadjusted 429.   185.  </span></span>
<span><span class="co">## Adjusted   331.75  66.55</span></span></code></pre>
<p>The input is similar to that for using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with
<code>MatchIt</code> or <code>WeightIt</code>.</p>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-cem">Using <code>bal.tab()</code> with <code>cem</code><a class="anchor" aria-label="anchor" href="#using-bal-tab-with-cem"></a>
</h3>
<p>The <code>cem</code> package implements coarsened exact matching for
binary and multi-category treatments. <code><a href="../reference/bal.tab.html">bal.tab()</a></code> functions
similarly to <code>cems</code>’s <code><a href="https://rdrr.io/pkg/cem/man/imbalance.html" class="external-link">imbalance()</a></code>. Below is a
simple example of using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with
<code>cem</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Coarsened exact matching</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span> <span class="co">#If not yet loaded</span></span>
<span></span>
<span><span class="co">#Matching for balance on covariates</span></span>
<span><span class="va">cem.out</span> <span class="op">&lt;-</span> <span class="fu">cem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cem/man/cem.html" class="external-link">cem</a></span><span class="op">(</span><span class="st">"treat"</span>, data <span class="op">=</span> <span class="va">lalonde</span>, drop <span class="op">=</span> <span class="st">"re78"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">cem.out</span>, data <span class="op">=</span> <span class="va">lalonde</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"ks"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Adj KS.Adj</span></span>
<span><span class="co">## age         Contin.   0.0512 0.1581</span></span>
<span><span class="co">## educ        Contin.  -0.0441 0.0445</span></span>
<span><span class="co">## race_black   Binary   0.0000 0.0000</span></span>
<span><span class="co">## race_hispan  Binary   0.0000 0.0000</span></span>
<span><span class="co">## race_white   Binary   0.0000 0.0000</span></span>
<span><span class="co">## married      Binary   0.0000 0.0000</span></span>
<span><span class="co">## nodegree     Binary   0.0000 0.0000</span></span>
<span><span class="co">## re74        Contin.  -0.0341 0.2418</span></span>
<span><span class="co">## re75        Contin.  -0.0528 0.1162</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##                      Control Treated</span></span>
<span><span class="co">## All                   429.       185</span></span>
<span><span class="co">## Matched (ESS)          36.29      68</span></span>
<span><span class="co">## Matched (Unweighted)   78.        68</span></span>
<span><span class="co">## Unmatched             351.       117</span></span></code></pre>
<p>The input is similar to that for using <code><a href="../reference/bal.tab.html">bal.tab()</a></code> with
<code>Matching</code> or <code>optmatch</code>. In addition to the
<code><a href="https://rdrr.io/pkg/cem/man/cem.html" class="external-link">cem()</a></code> output object, one must specify either both a formula
and a data set or both a treatment vector and a data frame of
covariates. Unlike with <code>Matching</code>, entering the treatment
variable is optional as it is already stored in the output object. The
output is similar to that of <code>optmatch</code>.</p>
<p>When using <code><a href="https://rdrr.io/pkg/cem/man/cem.html" class="external-link">cem()</a></code> with multiply imputed data (i.e., by
supplying a list of data.frames to the <code>datalist</code> argument in
<code><a href="https://rdrr.io/pkg/cem/man/cem.html" class="external-link">cem()</a></code>), an argument to <code>imp</code> should be specified
to <code><a href="../reference/bal.tab.html">bal.tab()</a></code> or a <code>mids</code> object from the
<code>mice</code> package should be given as the argument to
<code>data</code>. See <code>?bal.tab.imp</code> or the accompanying
Appendix 2 for more information about using <code>cobalt</code> with
multiply imputed data. Below is an example of using <code>cem</code>
with multiply imputed data from <code>mice</code>:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Coarsened exact matching on multiply imputed data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde_mis"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Generate imputed data sets</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co">#number of imputed data sets</span></span>
<span><span class="va">imp.out</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">lalonde_mis</span>, m <span class="op">=</span> <span class="va">m</span>, print <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="va">imp.data.list</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">imp.out</span>, <span class="st">"all"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Match within each imputed dataset</span></span>
<span><span class="va">cem.out.imp</span> <span class="op">&lt;-</span> <span class="fu">cem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cem/man/cem.html" class="external-link">cem</a></span><span class="op">(</span><span class="st">"treat"</span>, datalist <span class="op">=</span> <span class="va">imp.data.list</span>,</span>
<span>                        drop <span class="op">=</span> <span class="st">"re78"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Using 'treat'='1' as baseline group</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">cem.out.imp</span>, data <span class="op">=</span> <span class="va">imp.out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance summary across all imputations</span></span></span>
<span><span class="co">##                Type Min.Diff.Adj Mean.Diff.Adj Max.Diff.Adj</span></span>
<span><span class="co">## age         Contin.       0.0426        0.0467       0.0501</span></span>
<span><span class="co">## educ        Contin.      -0.0441       -0.0381      -0.0311</span></span>
<span><span class="co">## race_black   Binary      -0.0000       -0.0000       0.0000</span></span>
<span><span class="co">## race_hispan  Binary      -0.0000       -0.0000       0.0000</span></span>
<span><span class="co">## race_white   Binary      -0.0000       -0.0000       0.0000</span></span>
<span><span class="co">## married      Binary      -0.0000       -0.0000       0.0000</span></span>
<span><span class="co">## nodegree     Binary      -0.0000       -0.0000       0.0000</span></span>
<span><span class="co">## re74        Contin.      -0.0423       -0.0367      -0.0328</span></span>
<span><span class="co">## re75        Contin.      -0.0864       -0.0589      -0.0486</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Average sample sizes across imputations</span></span></span>
<span><span class="co">##                           0     1</span></span>
<span><span class="co">## All                  429.   185. </span></span>
<span><span class="co">## Matched (ESS)         35.83  66.7</span></span>
<span><span class="co">## Matched (Unweighted)  78.3   66.7</span></span>
<span><span class="co">## Unmatched            350.7  118.3</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="using-bal-tab-with-other-packages">Using <code>bal.tab()</code> with other packages<a class="anchor" aria-label="anchor" href="#using-bal-tab-with-other-packages"></a>
</h3>
<p>It is possible to use <code>bal.tab</code> with objects that don’t
come from these packages using the <code>default</code> method. If an
object that doesn’t correspond to the output from one of the
specifically supported packages is passed as the first argument to
<code>bal.tab</code>, <code>bal.tab</code> will do its best to process
that object as if it did come from a supported package. It will search
through the components of the object for items with names like
<code>"treat"</code>, <code>"covs"</code>, <code>"data"</code>,
<code>"weights"</code>, etc., that have the correct object types. Any
additional arguments can be specified by the user.</p>
<p>The goal of the <code>default</code> method is to allow package
authors to rely on <code>cobalt</code> as a substitute for any balancing
function they might otherwise write. By ensuring compatibility with the
<code>default</code> method, package authors can have their users simply
supply the output of a compatible function into <code>cobalt</code>
functions without having to write a specific method in
<code>cobalt</code>. A package author would need to make sure the output
of their package contained enough information with correctly named
components; if so, <code>cobalt</code> functions can be used as
conveniently with the output as it is with specifically supported
packages.</p>
<p>Below, we demonstrate this capability with the output of
<code>optweight</code>, which performs a version of propensity score
weighting using optimization, similar to <code>sbw</code>. No
<code>bal.tab</code> method has been written with <code>optweight</code>
output in mind; rather, <code>optweight</code> was written to have
output compatible with the <code>default</code> method of
<code>bal.tab</code>.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Optimization-based weighting</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Estimate the weights using optimization</span></span>
<span><span class="va">ow.out</span> <span class="op">&lt;-</span> <span class="fu">optweight</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/optweight/man/optweight.html" class="external-link">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                               data <span class="op">=</span> <span class="va">lalonde</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span>, tols <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Note the contents of the output object:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ow.out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "weights"   "treat"     "covs"      "s.weights" "estimand"  "focal"    </span></span>
<span><span class="co">##  [7] "call"      "tols"      "duals"     "info"</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Use bal.tab() directly on the output</span></span>
<span><span class="fu"><a href="../reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">ow.out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Call</span></span></span>
<span><span class="co">##  optweight::optweight(formula = treat ~ age + educ + married + </span></span>
<span><span class="co">##     race + re74 + re75, data = lalonde, tols = 0.01, estimand = "ATE")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Adj</span></span>
<span><span class="co">## age         Contin.  -0.0000</span></span>
<span><span class="co">## educ        Contin.   0.0100</span></span>
<span><span class="co">## married      Binary  -0.0100</span></span>
<span><span class="co">## race_black   Binary   0.0100</span></span>
<span><span class="co">## race_hispan  Binary  -0.0000</span></span>
<span><span class="co">## race_white   Binary  -0.0100</span></span>
<span><span class="co">## re74        Contin.  -0.0100</span></span>
<span><span class="co">## re75        Contin.   0.0085</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted  429.    185.  </span></span>
<span><span class="co">## Adjusted    349.42   52.04</span></span></code></pre>
<p>The output is treated as output from a specifically supported
package. See <code><a href="../reference/bal.tab.default.html">?bal.tab.default</a></code> for more details and another
example.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
